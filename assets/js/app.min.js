$(document).ready(function(){function ba(a,b){aa[a]=b,Lb()}function ca(a){return a.charAt(0).toUpperCase()+a.slice(1)}function da(a){aa=a;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=["font","size","theme","margin"];if(d.indexOf(b)>-1){var e;e="size"==b?".font-"+b+"-options":"."+b+"-options",$(e).children().removeClass("active"),$(e).children().filter(function(){return $(this).text()==ca(c)}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},400)})}else c=!1===c?"toggle-inactive":"toggle-active","toggle-active"==c&&$("."+b).click(),"focus"==b&&"toggle-inactive"==c&&(xb=!1,$(".ql-editor *").css("opacity","1"))}ka().click()}function ha(a,b){a.find(".document-title").val(b)}function ia(a,b){a.find(".document-size").text(b)}function ja(a){return a?$(".document-active").index():$(".document-active")}function ka(){return $(".doc-active")}function la(a,b,c){a.removeClass(b),a.addClass(c)}function na(){this.name,this.size,this.contents,this.fileEntry,this.savedFileEntry,this.isActive,this.editor,this.editorDOM,this.docListItem,ma=this}function oa(a){var c=$(document.createElement("div"));c.addClass("temporary-editor"),b.append(c);var d=new Quill(".temporary-editor");c.children().first().html(a);var f=d.getContents();return c.remove(),f}function pa(){v.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),w.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),z.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),A.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)})}function ra(a){return/<[\s\S]*>/i.test(a)}function sa(a){return!$.trim(a.html())}function ta(a){return a.replaceAll(' 0.6;"=""',"").replaceAll(' 1;"=""',"").replaceAll("=3D","=").replaceAll('="3D','="').replaceAll('class="3D&quot;','class="').replaceAll("&quot;","")}function ua(a){var b=$(document.createElement("div"));return b.addClass("htmlParent"),b.html(a),b.find("*").each(function(){sa($(this))&&$(this).html("<br/>")}),b.find("ol, ul").each(function(){var a=$(this).parentsUntil(b).length-1;if(-1!=a&&$(this).children().not("ol").not("ul").attr("class","ql-indent-"+a),!$(this).parent().is(b)){var c=$(this).contents();$(this).replaceWith(c)}}),b.find("li").each(function(){$(this).find("li").length&&$(this).find("li").insertAfter($(this))}),b.find("p").each(function(){if($(this).parent().is("li")||$(this).parent().is("blockquote")){var a=$(this).contents();$(this).replaceWith(a)}}),b.find("table").remove(),ta(b.html())}function va(a){return-1==a.indexOf(".")?a:a.substr(0,a.lastIndexOf("."))}function wa(a){var b=$(document.createElement("div"));return b.html(a),b.find("*").removeAttr("style"),b.html()}function xa(a,b,c,d){a.write(c),b.loadFile(d.name,c.size,d,!1),lb(!1,!1,d.name),Lb()}function ya(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(b){var e,f,c=Ka(a.name),d=Ha(ja(!0));switch(c){case"html":case"htm":case"wtr":e=wa(Ia().html()),f=new Blob([e]),xa(b,d,f,a);break;case"md":require(["upndown"],function(c){(new c).convert(wa(Ia().html()),function(c,g){c?console.log(c):(e=g,f=new Blob([e]),xa(b,d,f,a))})});break;case"docx":e="<!DOCTYPE HTML><html><head></head><body>"+wa(Ia().html())+"</body></html>",f=htmlDocx.asBlob(e),xa(b,d,f,a);break;case"pdf":f=pdfBlob,xa(b,d,f,a);break;case"txt":default:e=d.editor.getText(),f=new Blob([e]),xa(b,d,f,a)}var g=!1;b.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)}})}):console.log("User cancelled saving.")}function za(a){a=va(a),window.navigator.userAgent.indexOf("CrOS")>-1&&(a+=".wtr"),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,accepts:Z},ya)}function Aa(){ga.forEach(function(a,b,c){Ha(b).setActive(!1)})}function Ba(a){Ha(a).editor.focus()}function Ca(a){ga.push(a)}function Da(a,b,c,d){a.create(b,c,d)}function Ea(a,b,c,d,e){a.load(b,c,d,e)}function Fa(a,b,c,d,e,f,g){var h=new na;0!=a&&(b="untitled",c="",d="0 KB",e=!1,f=!0,g=!1),Da(h,b,d,f),Ea(h,b,c,d,e,g),Ca(h),cb(),Lb()}function Ga(a){a.delete()}function Ha(a){return ga[a]}function Ia(){return $(".document-active .ql-editor")}function Ja(){return $(".ql-editor")}function Ka(a){return a.substring(a.lastIndexOf(".")+1,a.length)}function La(a){"li"==a.get(0).nodeName.toLowerCase()?(Ia().find("*").css("opacity","0.6"),a.parent().css("opacity","1"),a.parent().children().css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1")):(Ia().find("*").css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1"))}function Ma(a){a=a||window;var d,e,f,b=a.document,c=b.selection,g=0;return c?"Control"!=c.type&&(d=c.createRange(),d.collapse(!0),x=d.boundingLeft,g=d.boundingTop):a.getSelection&&(c=a.getSelection(),c.rangeCount&&(d=c.getRangeAt(0).cloneRange(),d.getClientRects&&(d.collapse(!0),e=d.getClientRects(),e.length>1&&(f=e[1]),void 0===f&&void 0===(f=e[0])&&(f=Oa(),$(f).hasClass("ql-editor")||(f=f.getClientRects()[0])),g=f.top))),{y:g}}function Na(a){setTimeout(function(){var b=Ia(),c=b.scrollTop(),d=Ma(),e=c+d.y-b.height()/2-100;a?b.stop().animate({scrollTop:e},300,Y,function(){Ha(ja(!0)).scrollTop=e}):b.filter(":not(:animated)").animate({scrollTop:e},300,Y,function(){Ha(ja(!0)).scrollTop=e})},1)}function Oa(){var a,b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount>0&&(a=b.getRangeAt(0))),a)return c=a.commonAncestorContainer,3===c.nodeType?c.parentNode:c}function Pa(){if(!1===xb);else{var a=Oa(),b=a.nodeName.toLowerCase(),c=["h1","h2","h3","h4","h5","h6","p","blockquote","pre","li"];if($(a).hasClass("ql-editor"));else if(-1==c.indexOf(b)){for(;-1==c.indexOf(b);)a=$(a).parent(),b=a.prop("tagName").toLowerCase();La($(a))}else La($(a))}}function Qa(a,b){a==B&&Wa(),Ia().blur(),window.getSelection().removeAllRanges(),k.is(":visible")?a.show().filter(":not(:animated)").animate({left:"0"},200,Y,function(){b&&b()}):k.show().filter(":not(:animated)").animate({opacity:"0.5"},200,Y,function(){a.show().filter(":not(:animated)").animate({left:"0"},200,Y)})}function Ra(){k.filter(":not(:animated)").animate({opacity:"0"},200,Y,function(){$(this).hide(),Ba(ja(!0)),Pa();var a=Ha(ja(!0)).scrollTop;ja().children().first().scrollTop(a)})}function Sa(a){a.filter(":not(:animated)").animate({left:"-"+a.width()},200,Y,function(){$(this).hide()}),1==j.filter(function(){return $(this).is(":visible")}).length&&Ra()}function Ta(){Sa(j),Ra()}function Va(a){var c,d,b=Ka(a.name),e=ga.indexOf(a),f=$(".document-"+e).find(".ql-editor").html();switch(b){case"html":case"htm":case"wtr":c=f,d=new Blob([c]);break;case"md":c=toMarkdown(f),d=new Blob([c]);break;case"docx":c="<!DOCTYPE HTML><html><head></head><body>"+f+"</body></html>",d=htmlDocx.asBlob(c);break;case"txt":default:c=a.editor.getText(),d=new Blob([c])}return Math.floor(d.size/1e3)}function Wa(){d.children().each(function(){var a=Ha($(this).index()),b=Va(a);a.setSize(b+" KB"),ia($(this),b+" KB")})}function Xa(a,b){var c=new FileReader;c.onload=function(){var d=this.result;if(d.indexOf('<w:altChunk r:id="htmlChunk" />')>-1)d=d.substring(d.lastIndexOf("<!DOCTYPE HTML><html><head></head><body>")+15,d.lastIndexOf("</body></html>")),Fa(!1,a.name,d,a.size,b,!0,!1),Ta();else{new FileReader;c.onload=function(){var c=this.result;mammoth.convertToHtml({arrayBuffer:c}).then(function(d){c=d.value,Fa(!1,a.name,c,a.size,b,!0,!1),Ta()}).done()},c.readAsArrayBuffer(a)}},c.readAsText(a)}function Ya(a){return a.replace(/\n\n  \n\n\n/g,"<p><p>")}function Za(a,b,c){var d=new FileReader;d.onload=function(){var d=this.result;c?(d=Ya(d),d=marked(d),d=ua(d),Fa(!1,a.name,d,a.size,b,!0,!1),Ta()):(Fa(!1,a.name,d,a.size,b,!0,!1),Ta())},d.readAsText(a)}function $a(a){for(var b=0;b<ga.length;b++)if(ga[b].path==a)return!0;return!1}function _a(a){a.forEach(function(a,b,c){var d=a;1==$a(d.fullPath)?(Ta(),lb(!0,"is already open.",d.name)):d.file(function(a){switch(Ka(a.name)){case"md":Za(a,d,!0);break;case"docx":Xa(a,d);break;case"html":case"htm":case"txt":case"wtr":default:Za(a,d,!1)}})})}function ab(a,b){var c=new FileReader;c.onload=function(){var a=this.result;void 0!=b&&b.attr("src",a)},c.readAsDataURL(a)}function bb(a,b){if(-1==a.indexOf("data:")){var c=new XMLHttpRequest;c.open("GET",a),c.responseType="blob",c.onload=function(){ab(c.response,b)}.bind(this),c.send()}b.show()}function cb(){Ia().find("img").each(function(){if(void 0===$(this).attr("src"));else{bb($(this).attr("src"),$(this))}})}function db(a){var b=fb(a);return Math.round(b/200)+" Min"}function eb(a){return a.replace(/\n$/gm,"").split(/\n/).length}function fb(a){var b=a.trim().replace(/\s+/gi," ").split(" ");return b=""===b[0]&&1==b.length?0:b.length}function gb(a){return a.length-1}function hb(a){return null===a.match(/[\S]/g)?0:a.match(/[\S]/g).length}function ib(a,b){var c=a.editor.getText();jb({name:a.name,time:db(c),paragraphs:eb(c),words:fb(c),chars:gb(c),charsExSpaces:hb(c)},b)}function jb(a,b){var c=0;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];switch(d){case"name":$(".file-name-details").text(e);break;case"time":$(".est-time-amount").text(e);break;case"paragraphs":$(".paragraph-amount").text(e);break;case"words":$(".word-amount").text(e);break;case"chars":$(".character-amount").text(e);break;case"charsExSpaces":$(".characters-without-spaces-amount").text(e)}c++,c===a.length&&b()}}function lb(a,b,c){a||b?(T.children().first().text(c),T.children("span").text(b),T.show().stop().animate({bottom:"0"},500,Y,function(){kb=setTimeout(mb,5e3)})):(T.children().first().text(c),T.children("span").text("was saved."),T.show().stop().animate({bottom:"0"},500,Y,function(){kb=setTimeout(mb,3e3)}))}function mb(){T.animate({bottom:"-"+(T.height()+100)+"px"},500,Y,function(){$(this).hide(),clearTimeout(kb)})}function nb(a){return a.hasClass("toggle-active")}function rb(){Ja().css("transition","none"),$(".ql-editor *").css("transition","none"),clearTimeout(qb),qb=setTimeout(function(){sb()},200)}function sb(){Ja().css("transition","all .2s ease"),$(".ql-editor *").css("transition","all .2s ease")}function tb(a){var b='<link type="text/css" rel="stylesheet" href="assets/settings/themes/'+a+'"/>';$('link[href="'+a+'"]').length<1&&$("head").append(b)}function ub(a){$('link[href="assets/settings/themes/'+a+'"]').remove()}function vb(){var a=q.attr("name");la(q,"toggle-inactive","toggle-active"),ba(a,!0)}function wb(){var a=q.attr("name");la(q,"toggle-active","toggle-inactive"),ba(a,!1)}function yb(a){var b=$(".words"),c=$(".chars"),d=/\s+/gi,e=a.trim().replace(d," ").split(" "),f=a.length-1;e=""===e[0]&&1==e.length?0:e.length,b.text(e),c.text(f)}function zb(){yb(Ha(ja(!0)).editor.getText()),U.show().stop().animate({bottom:"0"},300,Y)}function Ab(){U.stop().animate({bottom:"-"+(U.height()+50)+"px"},300,Y,function(){$(this).hide()})}function Bb(a){return Number(a.replace("px",""))/12+.25+"em"}function Cb(a){Ja().css("padding-left",a),Ja().css("padding-right",a)}function Db(a){var b=40*a.children().length+"px";a.stop().show().animate({height:b},400,Y)}function Eb(a){a.stop().animate({height:"0"},400,Y,function(){$(this).hide()})}function Fb(a,b){a.attr("readonly",!0),a.blur(),b.find(".material-icons").length>1?b.find(".material-icons").eq(1).text("edit"):b.find(".material-icons").text("edit")}function Gb(a,b){a.attr("readonly",!1),a.select(),b.find(".material-icons").length>1?b.find(".document-edit").find(".material-icons").text("check"):b.find(".material-icons").text("check")}function Hb(a){"matrix(1, -2.44929e-16, 2.44929e-16, 1, 0, 0)"==a.css("transform")?a.css("transform","rotate(0deg)"):a.css("transform","rotate(360deg)")}function Ib(a){a.css("transform","translateX(-220px)")}function Jb(a){a.css("transform","translateX(0)")}function Kb(){setTimeout(function(){if(1==aa.statistics){yb(Ha(ja(!0)).editor.getText())}l.stop().animate({top:"-100%"},800,Y,function(){$(this).remove()})},800)}function Lb(){bc({settings:aa,data:ga})}function Mb(a,b){var c=new XMLHttpRequest;c.onload=function(){var a=new FileReader;a.onloadend=function(){b(a.result)},a.readAsDataURL(c.response)},c.open("GET",a),c.responseType="blob",c.send()}function Nb(a){var c=a;return 255-(.299*c.r+.587*c.g+.114*c.b)<105?"#000000":"#ffffff"}function Ob(){chrome.identity.removeCachedAuthToken({token:Qb},function(){});var a=new XMLHttpRequest;a.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+Qb),a.send()}function Pb(a,b){navigator.onLine?chrome.identity.getAuthToken({interactive:!0},function(c){Qb=c,chrome.runtime.lastError?!1===a?Ob():(Kb(),m.show(),bc({installed:!1})):$.get("https://www.googleapis.com/plus/v1/people/me?access_token="+c,function(a){var c=a.cover.coverPhoto.url,d=a.image.url,e=a.displayName;Mb(d,function(a){$(".user-image").css("background-image","url("+a+")");var c=document.createElement("img");c.setAttribute("src",a),c.addEventListener("load",function(){var a=new Vibrant(c),d=a.DarkMutedSwatch.rgb,e=d.join(","),f=Nb(d);$(".user-info").css("color",f),$(".fallback-signin").hide(),$(".sign-out").css({backgroundColor:"rgb("+e+")",color:f}),$(".sign-out .material-icons").css("color",f),$(".user-profile-body").show(),bc({installed:!0,signIn:!0}),b&&(m.stop().animate({top:"-100%"},800,Y,function(){$(this).remove()}),b())})}),Mb(c,function(a){$(".user-profile").css("background-image","url("+a+")")}),$(".user-name").text(e),chrome.identity.getProfileUserInfo(function(a){$(".user-email").text(a.email)})}).fail(function(){Ob()})}):(m.hide(),dc())}function Rb(a){cc({installed:"installed",signIn:"signIn"},function(a){var b=a.installed,c=a.signIn;"installed"==b||!1===b||"signIn"==c?(Kb(),m.show()):!1===c?dc():Pb(!1,dc)})}function Sb(){clearTimeout(Tb),f.stop().animate({top:"0"},400,Y),e.css("margin-top","30px"),e.css("height","calc(100% - 30px)"),j.css("margin-top","30px"),j.css("height","calc(100% - 30px)")}function Ub(){clearTimeout(Tb),Tb=setTimeout(function(){f.stop().animate({top:"-30px"},400,Y),e.css("margin-top","0px"),e.css("height","100%"),j.css("margin-top","0px"),j.css("height","100%")},1e3)}function Vb(){var a="Unknown OS",b=navigator.appVersion;return-1!=b.indexOf("Win")&&(a="Windows"),-1!=b.indexOf("Mac")&&(a="MacOS"),-1!=b.indexOf("X11")&&(a="UNIX"),-1!=b.indexOf("Linux")&&(a="Linux"),a}function Wb(a,b){return a.keyCode==b}function Xb(a){return"MacOS"==Vb()?a.metaKey:a.ctrlKey}function Yb(a){return a.shiftKey}function Zb(a){return a.altKey}function $b(){$(".arrow-down .material-icons").css("transform","rotate(180deg)"),$(".sign-out").show().stop().animate({height:"60px"},200,Y)}function _b(){$(".arrow-down .material-icons").css("transform","rotate(0deg)"),$(".sign-out").stop().animate({height:"0px"},200,Y,function(){$(this).hide()})}function ac(){$(".user-profile").css("background-image","url(../assets/sidebar/fallback.png)"),$(".user-profile-body").hide(),$(".fallback-signin").show()}function bc(a){chrome.storage.local.set(a)}function cc(a,b){chrome.storage.local.get(a,b)}function dc(){cc({settings:"settings",data:"documents"},function(a){var b=a.settings,c=a.data;if("settings"==b||"documents"==c)Fa(!0),da(_),Kb();else{var d=0;0===c.length?(Fa(!0),da(b),Kb()):c.forEach(function(a,e,f){var g=c[e];Fa(!1,g.name,g.contents,g.size,g.savedFileEntry,g.isActive,g.changed),ja().children().first().children().css("opacity","0.6"),ja().children().first().children().first().css("opacity","1"),++d===f.length&&(ec(),da(b),Kb())})}})}function ec(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),_a(b)}}function fc(){chrome.app.window.current().close()}service=analytics.getService("Writer"),service.getConfig().addCallback(function(a){a.setTrackingPermitted(!0)}),tracker=service.getTracker("UA-96857701-1"),tracker.sendAppView("MainView"),require.config({paths:{upndown:"/assets/libs/upndown/lib/upndown.bundle.min"}});var a=$("html"),b=$("body"),c=$(".top-bar"),d=$(".document-list"),e=$(".main-container"),f=$(".navigation-container"),g=$(".sidebar"),h=$(".sidebar-toggle"),j=($(".settings-container"),$(".modal")),k=$(".bg"),l=$(".loading-screen"),m=$(".install-screen"),n=$(".toggle"),o=$(".coffee"),p=$(".night"),q=$(".full"),r=$(".statistics"),s=$(".focus"),t=$(".settings-option"),u=$(".option"),v=$(".font-options").children(),w=$(".font-size-options").children(),y=$(".theme-options").children(),z=$(".line-options").children(),A=$(".margin-options").children(),B=$(".document-container"),C=$(".settings-container"),D=$(".feedback-container"),E=$(".details-container"),F=$(".help-container"),G=$(".file-container"),H=$(".open-documents"),I=$(".open-settings"),J=$(".open-feedback"),K=$(".open-details"),L=$(".open-help"),M=$(".open-file"),N=$(".modal-close"),O=$(".new"),P=$(".open"),Q=$(".save"),R=$(".save-as"),S=$(".print"),T=$(".snackbar"),U=$(".statistics-bar"),V=$(".feedback-email"),W=$(".feedback-email"),X=$(".feedback-message"),Y=$.bez([.17,.67,.29,1.01]),Z=[{description:"Writer Document (*.wtr)",extensions:["wtr"]},{description:"Word Document (*.docx)",extensions:["docx"]},{description:"Markdown File (*.md)",extensions:["md"]},{description:"HTML File (*.html)",extensions:["html"]},{description:"HTM File (*.htm)",extensions:["htm"]},{description:"Text File (*.txt)",extensions:["txt"]}],_={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},aa={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},ea='<div class="document-item"><div class="material-icons">insert_drive_file</div><input readonly=true class="document-title" type="text"/><div class="document-size"></div><div class="document-edit"><div class="material-icons">edit</div></div><div class="document-delete"><div class="material-icons">delete</div></div><div class="delete-dialogue"><div class="delete-confirm">Delete</div><div class="delete-cancel">Cancel</div></div></div>',fa='<div class="document document-active"></div>';$(".sidebar, .settings-container, .document-container, .bg, .option, .snackbar").hide();var ma,ga=[];na.prototype.setName=function(a){this.name=a},na.prototype.getName=function(){return this.name},na.prototype.setContents=function(a){ra(a)&&(a=oa(a)),this.contents=a},na.prototype.getContent=function(){return this.contents},na.prototype.setSize=function(a){this.size=a},na.prototype.getSize=function(){return this.size},na.prototype.setFileEntry=function(a){"string"==typeof a?this.loadFileEntry(a):(this.fileEntry=a,null===a||void 0===a||!1===a||(this.path=this.fileEntry.fullPath,this.setName(a.name),this.setSavedFileEntry(a)))},na.prototype.getFileEntry=function(){return this.fileEntry},na.prototype.setSavedFileEntry=function(a){this.savedFileEntry=chrome.fileSystem.retainEntry(a)},na.prototype.getSavedFileEntry=function(){return this.savedFileEntry},na.prototype.loadFileEntry=function(a){var b=this;chrome.fileSystem.restoreEntry(a,function(a){b.setFileEntry(a),b.path=b.fileEntry.fullPath})},na.prototype.createEditor=function(a){var b={alignLeft:{key:"W",shortKey:!0,handler:function(a,b){"left"!=b.format.align&&this.quill.formatLine(a,"align",!1)}},alignCenter:{key:"E",shortKey:!0,handler:function(a,b){"center"!=b.format.align?this.quill.formatLine(a,"align","center",!0):this.quill.formatLine(a,"align",!1)}},alignRight:{key:"R",shortKey:!0,handler:function(a,b){"right"!=b.format.align?this.quill.formatLine(a,"align","right",!0):this.quill.formatLine(a,"align",!1)}},makeHeadingOne:{key:"1",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",1,!0)}},makeHeadingTwo:{key:"2",shortKey:!0,altKey:!0,handler:function(a,b){2==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",2,!0)}},makeQuote:{key:"5",shortKey:!0,altKey:!0,handler:function(a,b){b.format.blockquote?this.quill.formatLine(a,"blockquote",!1):this.quill.formatLine(a,"blockquote",!0)}},makeCode:{key:"6",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format["code-block"]?this.quill.formatLine(a,"code-block",!1):this.quill.formatLine(a,"code-block",!0)}}};this.editor=new Quill(a,{modules:{keyboard:{bindings:b},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{align:[]}],["blockquote","code-block","link","image"],[{header:1},{header:2}]]},bounds:".main-container",theme:"bubble"});var c=this,d=this.editor;this.editorDOM=$(a).children().first();var e=this.editorDOM;pa(),1==aa.statistics&&yb(d.getText());var f;this.editor.on("text-change",function(){clearTimeout(f),f=setTimeout(function(){var f,b=Ha($(a).index()),c=b.getContent();f=ra(c)?e.html():d.getContents(),b.setContents(f),Lb()},1e3),c.changed=!0,1==aa.statistics&&yb(c.editor.getText())}),$(a).hasClass("document-active")&&(rb(),e.children().first().focus())},na.prototype.getEditor=function(){return this.editorDOM},na.prototype.getDocItem=function(){return this.docListItem},na.prototype.setActive=function(a){this.isActive=a},na.prototype.showCreate=function(a,b,c){d.append(ea),e.append(fa);var f=d.children().last();this.docListItem=f,!1===c?(e.children().last().attr("class","document-"+f.index()+" ql-container ql-bubble"),this.setActive(!1)):(d.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),e.children().removeClass("document-active"),e.children().last().attr("class","document-"+f.index()+" document-active ql-container ql-bubble"),this.setActive(!0)),this.createEditor(".document-"+f.index()),ha(f,a),ia(f,b)},na.prototype.show=function(a){d.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),e.children().removeClass("document-active"),e.children().eq(a).attr("class","document-"+a+" document-active ql-container ql-bubble"),this.editorDOM.scrollTop(this.scrollTop),this.setActive(!0),1==aa.statistics&&yb(this.editor.getText()),Lb()},na.prototype.create=function(a,b,c){this.setName(a),this.setContents(""),this.setSize(b),this.setFileEntry(!1),this.showCreate(a,b,c)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},na.prototype.setEditorContents=function(a){if("object"==typeof a)this.editor.setContents(a);else if(ra(a)){var b=ua(a);this.editorDOM.html(b)}else this.editor.setText(a);this.editor.history.clear()},na.prototype.load=function(a,b,c,d,e){this.setName(a),this.setContents(b),this.setEditorContents(b),this.setSize(c),this.setFileEntry(d),this.changed=e},na.prototype.loadFile=function(a,b,c,d){this.setName(a),this.setSize(b),this.setFileEntry(c),this.changed=d,ha(ka(),a),ia(ka(),b)},na.prototype.save=function(){var a=this.fileEntry,b=va(this.name);a?ya(a):za(b)},na.prototype.delete=function(){var a=ga.indexOf(this);this.editorDOM.parent().remove(),this.docListItem.remove(),ga.splice(a,1),0===ga.length?(Fa(!0),Ta()):a-1==ga.length-1?d.children().last().click():d.children().eq(a).click()},$(document).on("keyup",".ql-editor",function(a){Na([37,38,39,40,13].indexOf(a.keyCode)>-1),Ub(),Pa()}),$(document).on("click select",".ql-editor",function(){Na(),Pa()}),c.mouseenter(function(){Sb()}),$(document).on("mouseenter",".ql-editor",function(){Ub()});var Ua;h.click(function(){Ua=$(Oa()),Sb(),Qa(g)}),H.click(function(){Qa(B)}),I.click(function(){Qa(C)}),k.click(function(){var a=0;j.each(function(b){var c=parseInt($(this).css("zIndex"),10);c>a&&$(this).is(":visible")&&(a=c)}),j.filter(function(){return $(this).css("z-index")==a}).each(function(){Sa($(this))})}),N.click(function(){Sa($(this).parent().parent())}),O.click(function(){Fa(!0),Ta()}),P.click(function(){chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:Z},function(a){_a(a)})}),Q.click(function(){Ha(ja(!0)).save(),Ta()}),R.click(function(){za(Ha(ja(!0)).name),Ta()}),S.click(function(){var b=Ia().html();a.append('<div class="ql-editor" id="print"></div>');var d=$("#print");d.html(b),window.print(),d.remove()}),M.click(function(){Qa(G)}),J.click(function(){Qa(D,function(){D.find(".feedback-email").val($(".user-email").text()),D.find(".feedback-email").focus()})}),$(document).on("paste drop",function(){setTimeout(cb,0)}),$(document).on("error","img",function(){$(this).hide()}),$(".submit-button").click(function(){var b=(V.val(),W.val()),c=X.val(),d="mailto:writerchromeapp@gmail.com?subject="+b+"&body="+c,e=document.createElement("a");e.href=d,e.target="_blank",e.click()}),K.click(function(){ib(Ha(ja(!0)),Qa(E))}),L.click(function(){Qa(F)}),T.css("bottom","-"+(T.height()+100)+"px");var kb;$(document).on("click",".document-item",function(){var a=$(this).index(),b=Ha(a);Aa(),b.show(a),Ta()}),n.click(function(){var a=$(this).attr("name");nb($(this))?(la($(this),"toggle-active","toggle-inactive"),ba(a,!1)):(la($(this),"toggle-inactive","toggle-active"),ba(a,!0))}),n.mousedown(function(){$(this).children().css("transform","scale(1.15, .85)"),$(this).children().css("box-shadow","rgba(0, 0, 0, 0.1) 0px 0px 0px 8px")}),$(document).mouseup(function(){n.children().css("transform","none"),n.children().css("box-shadow","none")});var ob="/assets/settings/coffee.mp3",pb=new Audio(ob);o.click(function(){nb($(this))?pb.play():pb.pause()});var qb;p.click(function(){rb(),!1===nb($(this))?ub("night.css"):tb("night.css")}),q.click(function(){chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()});var xb;s.click(function(){!1===nb($(this))?(xb=!1,$(".ql-editor *").css("opacity","1")):(xb=!0,void 0===Ua&&(Ua=Ia().children().first()),La(Ua))}),U.css("bottom","-"+(U.height()+100)+"px"),r.click(function(){!1===nb($(this))?Ab():zb()}),v.click(function(){var a=$(this).text();Ja().css("font-family",a),ba("font",a)}),w.click(function(){var a=$(this).text();Ja().css("font-size",Bb(a)),ba("size",a)}),y.click(function(){var a=$(this).text();switch(a){case"Default":ub("dark.css"),ub("turquoise.css");break;case"Dark":tb("dark.css"),ub("turquoise.css");break;case"Turquoise":tb("turquoise.css"),ub("dark.css")}ba("theme",a)}),z.click(function(){var a=$(this).text(),b=a;"Single"==a&&(b=1),"Double"==a&&(b=2),Ja().css("line-height",b),ba("line",a)}),A.click(function(){var a=$(this).text(),b=a;switch(a){case"Small":b="8%";break;case"Medium":b="18%";break;case"Large":b="26%"}Cb(b),ba("margin",a)}),t.click(function(){if($(this).hasClass("noToggle")){var a=$(this).children().last();a.is(":visible")?Eb(a):Db(a)}}),u.children().click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}),$(document).on("click",".document-edit",function(a){a.stopImmediatePropagation(),a.stopPropagation();var b=$(this).parent().find("input"),c=b.parent().index(),d=b.val(),e=Ha(c);"check"==$(this).text()?(Fb(b,$(this)),d==e.name||(e.setFileEntry(null),e.setName(d))):Gb(b,$(this)),Hb($(this).find(".material-icons"))}),$(document).on("keyup",".document-title",function(a){var b=$(this).parent().index(),c=Ha(b),d=$(this).val();13==a.keyCode&&(Fb($(this),$(this).parent()),Hb($(this).parent().find(".document-edit").find(".material-icons")),d==c.name||(c.setFileEntry(null),c.setName(d)))}),$(document).on("click",".document-title",function(a){void 0===$(this).attr("readonly")&&(a.stopImmediatePropagation(),a.stopPropagation())}),$(document).on("click",".document-delete",function(a){a.stopPropagation();var b=$(this).parent().index(),c=Ha(b);c.changed?Ib($(this).parent()):Ga(c)}),$(document).on("click",".delete-confirm",function(a){a.stopPropagation(),Ga(Ha($(this).parent().parent().index()))}),$(document).on("click",".delete-cancel",function(a){a.stopPropagation(),Jb($(this).parent().parent())}),$(document).on("click",".ql-editor img",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var Qb;$(".signin-button").click(function(){Pb(!0,dc)}),$(".fallback-signin").click(function(){Pb(!1)}),$(".continue-button").click(function(){m.stop().animate({top:"-100%"},400,Y,function(){$(this).remove(),dc()}),bc({installed:!0,signIn:!1})});var Tb;Sb(),document.addEventListener("scroll",function(a){Ha(ja(!0)).scrollTop=Ia().scrollTop()},!0),$(document).on("keydown",function(a){var b=Xb(a),c=Yb(a),d=Zb(a),e=b&&!c&&Wb(a,78),f=b&&!c&&Wb(a,79),g=b&&!c&&!d&&Wb(a,83),h=b&&c&&!d&&Wb(a,83),i=b&&Wb(a,80),j=Wb(a,122),k=b&&c&&Wb(a,78),l=b&&c&&Wb(a,70),m=b&&d&&!c&&Wb(a,83),n=b&&d&&Wb(a,81),o=b&&Wb(a,191),q=Wb(a,27);if(e&&(a.preventDefault(),O.click()),f&&P.click(),g&&Q.click(),h&&R.click(),i&&S.click(),j&&(chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()),k&&(a.preventDefault(),p.click()),l&&s.click(),m&&r.click(),q&&(a.preventDefault(),fc()),o&&(F.is(":visible")?(Ub(),Sa(F)):(Sb(),Qa(F))),n)if(B.is(":visible"))ka().find(".delete-confirm").click();else{var t=Ha(ja(!0));t.changed?Qa(B,ka().find(".document-delete").click()):ka().find(".document-delete").click()}}),X.on("keydown keyup change",function(){$(this).css("height","auto"),$(this).css("height",this.scrollHeight+"px")}),chrome.runtime.onMessage.addListener(function(a,b,c){(a.max||a.min||a.restored)&&wb(),a.full&&vb(),a.open&&ec()}),$(".sign-out").css({height:"0",display:"none"}),$(".arrow-down").click(function(){$(".sign-out").is(":visible")?_b():$b()}),$(".sign-out").click(function(){Ob(),_b(),ac(),bc({signIn:!1})}),Rb(dc),$(".close-window").click(function(){fc()}),$(".maximize-window").click(function(){chrome.app.window.current().isMaximized()||chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}),$(".minimize-window").click(function(){chrome.app.window.current().minimize()})});
