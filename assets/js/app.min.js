$(document).ready(function(){function X(a,b){W[a]=b,Eb()}function Y(a){return a.charAt(0).toUpperCase()+a.slice(1)}function Z(a){W=a;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=["font","size","theme","margin"];if(d.indexOf(b)>-1){var e;e="size"==b?".font-"+b+"-options":"."+b+"-options",$(e).children().removeClass("active"),$(e).children().filter(function(){return $(this).text()==Y(c)}).each(function(){$(this).click(),setTimeout(function(){s.css("height","0"),s.hide()},400)})}else c=!1===c?"toggle-inactive":"toggle-active","toggle-active"==c&&$("."+b).click(),"focus"==b&&"toggle-inactive"==c&&(qb=!1,$(".ql-editor *").css("opacity","1"))}$(".doc-active").click()}function ca(a,b){a.find(".document-title").val(b)}function da(a,b){a.find(".document-size").text(b)}function ea(){return $(".document-active")}function fa(a,b,c){a.removeClass(b),a.addClass(c)}function ha(){this.name,this.size,this.contents,this.fileEntry,this.savedFileEntry,this.isActive,this.editor,this.editorDOM,this.docListItem,ga=this}function ia(b){var c=$(document.createElement("div"));c.addClass("temporary-editor"),a.append(c);var d=new Quill(".temporary-editor");c.children().first().html(b);var f=d.getContents();return c.remove(),f}function ja(){t.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){s.css("height","0"),s.hide()},200)}),u.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){s.css("height","0"),s.hide()},200)}),w.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){s.css("height","0"),s.hide()},200)}),y.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){s.css("height","0"),s.hide()},200)})}function la(a){return/<[\s\S]*>/i.test(a)}function ma(a){return!$.trim(a.html())}function na(a){return a.replaceAll(' 0.6;"=""',"").replaceAll(' 1;"=""',"").replaceAll("=3D","=").replaceAll('="3D','="').replaceAll('class="3D&quot;','class="').replaceAll("&quot;","")}function oa(a){var b=$(document.createElement("div"));return b.addClass("htmlParent"),b.html(a),b.find("*").each(function(){ma($(this))&&$(this).html("<br/>")}),b.find("ol, ul").each(function(){var a=$(this).parentsUntil(b).length-1;if(-1!=a&&$(this).children().not("ol").not("ul").attr("class","ql-indent-"+a),!$(this).parent().is(b)){var c=$(this).contents();$(this).replaceWith(c)}}),b.find("li").each(function(){$(this).find("li").length&&$(this).find("li").insertAfter($(this))}),b.find("p").each(function(){if($(this).parent().is("li")||$(this).parent().is("blockquote")){var a=$(this).contents();$(this).replaceWith(a)}}),b.find("table").remove(),na(b.html())}function pa(a){return-1==a.indexOf(".")?a:a.substr(0,a.lastIndexOf("."))}function qa(a){var b=$(document.createElement("div"));return b.html(a),b.find("*").removeAttr("style"),b.html()}function ra(a,b,c,d){a.write(c),b.loadFile(d.name,c.size,d,!1),eb(!1,!1,d.name),Eb()}function sa(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(b){var e,f,c=Da(a.name),d=Ba(ea().index());switch(c){case"html":case"htm":case"wtr":e=qa(Ca().html()),f=new Blob([e]),ra(b,d,f,a);break;case"md":require(["upndown"],function(c){(new c).convert(qa(Ca().html()),function(c,g){c?console.log(c):(e=g,f=new Blob([e]),ra(b,d,f,a))})});break;case"docx":e="<!DOCTYPE HTML><html><head></head><body>"+qa(Ca().html())+"</body></html>",f=htmlDocx.asBlob(e),ra(b,d,f,a);break;case"pdf":f=pdfBlob,ra(b,d,f,a);break;case"txt":default:e=d.editor.getText(),f=new Blob([e]),ra(b,d,f,a)}var g=!1;b.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)}})}):console.log("User cancelled saving.")}function ta(a){a=pa(a),window.navigator.userAgent.indexOf("CrOS")>-1&&(a+=".wtr"),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,accepts:U},sa)}function ua(){ba.forEach(function(a,b,c){Ba(b).setActive(!1)})}function va(a){Ba(a).editor.focus()}function wa(a){ba.push(a)}function xa(a,b,c,d){a.create(b,c,d)}function ya(a,b,c,d,e){a.load(b,c,d,e)}function za(a,b,c,d,e,f){var g=new ha;xa(g,a,c,e),ya(g,a,b,c,d,f),wa(g),Xa()}function Aa(a){a.delete()}function Ba(a){return ba[a]}function Ca(){return $(".document-active .ql-editor")}function Da(a){return a.substring(a.lastIndexOf(".")+1,a.length)}function Ea(a){"li"==a.get(0).nodeName.toLowerCase()?(Ca().find("*").css("opacity","0.6"),a.parent().css("opacity","1"),a.parent().children().css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1")):(Ca().find("*").css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1"))}function Fa(a){a=a||window;var d,e,f,b=a.document,c=b.selection,g=0;return c?"Control"!=c.type&&(d=c.createRange(),d.collapse(!0),x=d.boundingLeft,g=d.boundingTop):a.getSelection&&(c=a.getSelection(),c.rangeCount&&(d=c.getRangeAt(0).cloneRange(),d.getClientRects&&(d.collapse(!0),e=d.getClientRects(),e.length>1&&(f=e[1]),void 0===f&&void 0===(f=e[0])&&(f=Ha(),$(f).hasClass("ql-editor")||(f=f.getClientRects()[0])),g=f.top))),{y:g}}function Ga(a){setTimeout(function(){var b=Ca(),c=b.scrollTop(),d=Fa(),e=c+d.y-b.height()+50;a?b.stop().animate({scrollTop:e},300,T,function(){Ba(ea().index()).scrollTop=e}):b.filter(":not(:animated)").animate({scrollTop:e},300,T,function(){Ba(ea().index()).scrollTop=e})},1)}function Ha(){var a,b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount>0&&(a=b.getRangeAt(0))),a)return c=a.commonAncestorContainer,3===c.nodeType?c.parentNode:c}function Ia(){if(!1===qb);else{var a=Ha(),b=a.nodeName.toLowerCase(),c=["h1","h2","h3","h4","h5","h6","p","blockquote","pre","li"];if($(a).hasClass("ql-editor"));else if(-1==c.indexOf(b)){for(;-1==c.indexOf(b);)a=$(a).parent(),b=a.prop("tagName").toLowerCase();Ea($(a))}else Ea($(a))}}function Ja(a,b){a==z&&Pa(),Ca().blur(),window.getSelection().removeAllRanges(),i.is(":visible")?a.show().filter(":not(:animated)").animate({left:"0"},200,T,function(){b&&b()}):i.show().filter(":not(:animated)").animate({opacity:"0.5"},200,T,function(){a.show().filter(":not(:animated)").animate({left:"0"},200,T)})}function Ka(){i.filter(":not(:animated)").animate({opacity:"0"},200,T,function(){$(this).hide(),va(ea().index()),Ia();var a=Ba(ea().index()).scrollTop;ea().children().first().scrollTop(a)})}function La(a){a.filter(":not(:animated)").animate({left:"-"+a.width()},200,T,function(){$(this).hide()}),1==h.filter(function(){return $(this).is(":visible")}).length&&Ka()}function Ma(){La(h),Ka()}function Oa(a){var c,d,b=Da(a.name),e=ba.indexOf(a),f=$(".document-"+e).find(".ql-editor").html();switch(b){case"html":case"htm":case"wtr":c=f,d=new Blob([c]);break;case"md":c=toMarkdown(f),d=new Blob([c]);break;case"docx":c="<!DOCTYPE HTML><html><head></head><body>"+f+"</body></html>",d=htmlDocx.asBlob(c);break;case"txt":default:c=a.editor.getText(),d=new Blob([c])}return Math.floor(d.size/1e3)}function Pa(){b.children().each(function(){var a=Ba($(this).index()),b=Oa(a);a.setSize(b+" KB"),da($(this),b+" KB")})}function Qa(a,b){var c=new FileReader;c.onload=function(){var d=this.result;if(d.indexOf('<w:altChunk r:id="htmlChunk" />')>-1)d=d.substring(d.lastIndexOf("<!DOCTYPE HTML><html><head></head><body>")+15,d.lastIndexOf("</body></html>")),za(a.name,d,a.size,b,!0,!1),Ma();else{new FileReader;c.onload=function(){var c=this.result;mammoth.convertToHtml({arrayBuffer:c}).then(function(d){c=d.value,za(a.name,c,a.size,b,!0,!1),Ma()}).done()},c.readAsArrayBuffer(a)}},c.readAsText(a)}function Ra(a){return a.replace(/\n\n  \n\n\n/g,"<p><p>")}function Sa(a,b,c){var d=new FileReader;d.onload=function(){var d=this.result;c?(d=Ra(d),d=marked(d),d=oa(d),za(a.name,d,a.size,b,!0,!1),Ma()):(za(a.name,d,a.size,b,!0,!1),Ma())},d.readAsText(a)}function Ta(a){for(var b=0;b<ba.length;b++)if(ba[b].path==a)return!0;return!1}function Ua(a){a.forEach(function(a,b,c){var d=a;1==Ta(d.fullPath)?(Ma(),eb(!0,"is already open.",d.name)):d.file(function(a){switch(Da(a.name)){case"md":Sa(a,d,!0);break;case"docx":Qa(a,d);break;case"html":case"htm":case"txt":case"wtr":default:Sa(a,d,!1)}})})}function Va(a,b){var c=new FileReader;c.onload=function(){var a=this.result;void 0!=b&&b.attr("src",a)},c.readAsDataURL(a)}function Wa(a,b){if(-1==a.indexOf("data:")){var c=new XMLHttpRequest;c.open("GET",a),c.responseType="blob",c.onload=function(){Va(c.response,b)}.bind(this),c.send()}b.show()}function Xa(){Ca().find("img").each(function(){if(void 0===$(this).attr("src"));else{Wa($(this).attr("src"),$(this))}})}function Ya(a){var b=$a(a);return Math.round(b/200)+" Min"}function Za(a){return a.replace(/\n$/gm,"").split(/\n/).length}function $a(a){var b=a.trim().replace(/\s+/gi," ").split(" ");return b=""===b[0]&&1==b.length?0:b.length}function _a(a){return a.length-1}function ab(a){return null===a.match(/[\S]/g)?0:a.match(/[\S]/g).length}function bb(a,b){var c=a.editor.getText();cb({name:a.name,time:Ya(c),paragraphs:Za(c),words:$a(c),chars:_a(c),charsExSpaces:ab(c)},b)}function cb(a,b){var c=0;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];switch(d){case"name":$(".file-name-details").text(e);break;case"time":$(".est-time-amount").text(e);break;case"paragraphs":$(".paragraph-amount").text(e);break;case"words":$(".word-amount").text(e);break;case"chars":$(".character-amount").text(e);break;case"charsExSpaces":$(".characters-without-spaces-amount").text(e)}c++,c===a.length&&b()}}function eb(a,b,c){a||b?(R.children().first().text(c),R.children("span").text(b),R.show().stop().animate({bottom:"0"},500,T,function(){db=setTimeout(fb,5e3)})):(R.children().first().text(c),R.children("span").text("was saved."),R.show().stop().animate({bottom:"0"},500,T,function(){db=setTimeout(fb,3e3)}))}function fb(){R.animate({bottom:"-"+(R.height()+100)+"px"},500,T,function(){$(this).hide(),clearTimeout(db)})}function gb(a){return a.hasClass("toggle-active")}function kb(){$(".ql-editor").css("transition","none"),$(".ql-editor *").css("transition","none"),clearTimeout(jb),jb=setTimeout(function(){lb()},200)}function lb(){$(".ql-editor").css("transition","all .2s ease"),$(".ql-editor *").css("transition","all .2s ease")}function mb(a){var b='<link type="text/css" rel="stylesheet" href="assets/settings/themes/'+a+'"/>';$('link[href="'+a+'"]').length<1&&$("head").append(b)}function nb(a){$('link[href="assets/settings/themes/'+a+'"]').remove()}function ob(){var a=o.attr("name");fa(o,"toggle-inactive","toggle-active"),X(a,!0)}function pb(){var a=o.attr("name");fa(o,"toggle-active","toggle-inactive"),X(a,!1)}function rb(a){var b=$(".words"),c=$(".chars"),d=/\s+/gi,e=a.trim().replace(d," ").split(" "),f=a.length-1;e=""===e[0]&&1==e.length?0:e.length,b.text(e),c.text(f)}function sb(){rb(Ba(ea().index()).editor.getText()),S.show().stop().animate({bottom:"0"},300,T)}function tb(){S.stop().animate({bottom:"-"+(S.height()+50)+"px"},300,T,function(){$(this).hide()})}function ub(a){return Number(a.replace("px",""))/12+.25+"em"}function vb(a){$(".ql-editor").css("padding-left",a),$(".ql-editor").css("padding-right",a)}function wb(a){var b=40*a.children().length+"px";a.stop().show().animate({height:b},400,T)}function xb(a){a.stop().animate({height:"0"},400,T,function(){$(this).hide()})}function yb(a,b){a.attr("readonly",!0),a.blur(),b.find(".material-icons").length>1?b.find(".material-icons").eq(1).text("edit"):b.find(".material-icons").text("edit")}function zb(a,b){a.attr("readonly",!1),a.select(),b.find(".material-icons").length>1?b.find(".document-edit").find(".material-icons").text("check"):b.find(".material-icons").text("check")}function Ab(a){"matrix(1, -2.44929e-16, 2.44929e-16, 1, 0, 0)"==a.css("transform")?a.css("transform","rotate(0deg)"):a.css("transform","rotate(360deg)")}function Bb(a){a.css("transform","translateX(-220px)")}function Cb(a){a.css("transform","translateX(0)")}function Db(){setTimeout(function(){if(1==W.statistics){rb(Ba(ea().index()).editor.getText())}j.stop().animate({top:"-100%"},800,T,function(){$(this).remove()})},800)}function Eb(){Wb({settings:W,data:ba})}function Fb(a,b){var c=new XMLHttpRequest;c.onload=function(){var a=new FileReader;a.onloadend=function(){b(a.result)},a.readAsDataURL(c.response)},c.open("GET",a),c.responseType="blob",c.send()}function Gb(a){var c=a;return 255-(.299*c.r+.587*c.g+.114*c.b)<105?"#000000":"#ffffff"}function Hb(){chrome.identity.removeCachedAuthToken({token:Jb},function(){});var a=new XMLHttpRequest;a.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+Jb),a.send()}function Ib(a,b){navigator.onLine?chrome.identity.getAuthToken({interactive:!0},function(c){Jb=c,chrome.runtime.lastError?!1===a?Hb():(Db(),k.show(),Wb({installed:!1})):$.get("https://www.googleapis.com/plus/v1/people/me?access_token="+c,function(a){var c=a.cover.coverPhoto.url,d=a.image.url,e=a.displayName;Fb(d,function(a){$(".user-image").css("background-image","url("+a+")");var c=document.createElement("img");c.setAttribute("src",a),c.addEventListener("load",function(){var a=new Vibrant(c),d=a.DarkMutedSwatch.rgb,e=d.join(","),f=Gb(d);$(".user-info").css("color",f),$(".fallback-signin").hide(),$(".sign-out").css({backgroundColor:"rgb("+e+")",color:f}),$(".sign-out .material-icons").css("color",f),$(".user-profile-body").show(),Wb({installed:!0,signIn:!0}),b&&(k.stop().animate({top:"-100%"},800,T,function(){$(this).remove()}),b())})}),Fb(c,function(a){$(".user-profile").css("background-image","url("+a+")")}),$(".user-name").text(e),chrome.identity.getProfileUserInfo(function(a){$(".user-email").text(a.email)})}).fail(function(){Hb()})}):(k.hide(),Yb())}function Kb(a){Xb({installed:"installed",signIn:"signIn"},function(a){var b=a.installed,c=a.signIn;"installed"==b||!1===b||"signIn"==c?(Db(),k.show()):!1===c?Yb():Ib(!1,Yb)})}function Lb(){clearTimeout(Mb),d.stop().animate({top:"0"},400,T),c.css("margin-top","30px"),c.css("height","calc(100% - 30px)"),h.css("margin-top","30px"),h.css("height","calc(100% - 30px)")}function Nb(){clearTimeout(Mb),Mb=setTimeout(function(){d.stop().animate({top:"-30px"},400,T),c.css("margin-top","0px"),c.css("height","100%"),h.css("margin-top","0px"),h.css("height","100%")},1e3)}function Ob(){var a="Unknown OS",b=navigator.appVersion;return-1!=b.indexOf("Win")&&(a="Windows"),-1!=b.indexOf("Mac")&&(a="MacOS"),-1!=b.indexOf("X11")&&(a="UNIX"),-1!=b.indexOf("Linux")&&(a="Linux"),a}function Pb(a,b){return a.keyCode==b}function Qb(a){return"MacOS"==Ob()?a.metaKey:a.ctrlKey}function Rb(a){return a.shiftKey}function Sb(a){return a.altKey}function Tb(){$(".arrow-down .material-icons").css("transform","rotate(180deg)"),$(".sign-out").show().stop().animate({height:"60px"},200,T)}function Ub(){$(".arrow-down .material-icons").css("transform","rotate(0deg)"),$(".sign-out").stop().animate({height:"0px"},200,T,function(){$(this).hide()})}function Vb(){$(".user-profile").css("background-image","url(../assets/sidebar/fallback.png)"),$(".user-profile-body").hide(),$(".fallback-signin").show()}function Wb(a){chrome.storage.local.set(a)}function Xb(a,b){chrome.storage.local.get(a,b)}function Yb(){Xb({settings:"settings",data:"documents"},function(a){var b=a.settings,c=a.data;if("settings"==b||"documents"==c)za("untitled","","0 KB",!1,!0,!1),Z(V),Db();else{var d=0;0===c.length?(za("untitled","","0 KB",!1,!0,!1),Z(b),Db()):c.forEach(function(a,e,f){var g=c[e];za(g.name,g.contents,g.size,g.savedFileEntry,g.isActive,g.changed),ea().children().first().children().css("opacity","0.6"),ea().children().first().children().first().css("opacity","1"),++d===f.length&&(Zb(),Z(b),Db())})}})}function Zb(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),Ua(b)}}function $b(){chrome.app.window.current().close()}service=analytics.getService("Writer"),service.getConfig().addCallback(function(a){a.setTrackingPermitted(!0)}),tracker=service.getTracker("UA-96857701-1"),tracker.sendAppView("MainView"),require.config({paths:{upndown:"/assets/libs/upndown/lib/upndown.bundle.min"}});var a=$("body"),b=$(".document-list"),c=$(".main-container"),d=$(".navigation-container"),e=$(".sidebar"),f=$(".sidebar-toggle"),h=($(".settings-container"),$(".modal")),i=$(".bg"),j=$(".loading-screen"),k=$(".install-screen"),l=$(".toggle"),m=$(".coffee"),n=$(".night"),o=$(".full"),p=$(".statistics"),q=$(".focus"),r=$(".settings-option"),s=$(".option"),t=$(".font-options").children(),u=$(".font-size-options").children(),v=$(".theme-options").children(),w=$(".line-options").children(),y=$(".margin-options").children(),z=$(".document-container"),A=$(".settings-container"),B=$(".feedback-container"),C=$(".details-container"),D=$(".help-container"),E=$(".file-container"),F=$(".open-documents"),G=$(".open-settings"),H=$(".open-feedback"),I=$(".open-details"),J=$(".open-help"),K=$(".open-file"),L=$(".modal-close"),M=$(".new"),N=$(".open"),O=$(".save"),P=$(".save-as"),Q=$(".print"),R=$(".snackbar"),S=$(".statistics-bar"),T=$.bez([.17,.67,.29,1.01]),U=[{description:"Writer Document (*.wtr)",extensions:["wtr"]},{description:"Word Document (*.docx)",extensions:["docx"]},{description:"Markdown File (*.md)",extensions:["md"]},{description:"HTML File (*.html)",extensions:["html"]},{description:"HTM File (*.htm)",extensions:["htm"]},{description:"Text File (*.txt)",extensions:["txt"]}],V={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},W={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},_='<div class="document-item"><div class="material-icons">insert_drive_file</div><input readonly=true class="document-title" type="text"/><div class="document-size"></div><div class="document-edit"><div class="material-icons">edit</div></div><div class="document-delete"><div class="material-icons">delete</div></div><div class="delete-dialogue"><div class="delete-confirm">Delete</div><div class="delete-cancel">Cancel</div></div></div>',aa='<div class="document document-active"></div>';$(".sidebar, .settings-container, .document-container, .bg, .option, .snackbar").hide();var ga,ba=[];ha.prototype.setName=function(a){this.name=a},ha.prototype.getName=function(){return this.name},ha.prototype.setContents=function(a){la(a)&&(a=ia(a)),this.contents=a},ha.prototype.getContent=function(){return this.contents},ha.prototype.setSize=function(a){this.size=a},ha.prototype.getSize=function(){return this.size},ha.prototype.setFileEntry=function(a){"string"==typeof a?this.loadFileEntry(a):(this.fileEntry=a,null===a||void 0===a||!1===a||(this.path=this.fileEntry.fullPath,this.setName(a.name),this.setSavedFileEntry(a)))},ha.prototype.getFileEntry=function(){return this.fileEntry},ha.prototype.setSavedFileEntry=function(a){this.savedFileEntry=chrome.fileSystem.retainEntry(a)},ha.prototype.getSavedFileEntry=function(){return this.savedFileEntry},ha.prototype.loadFileEntry=function(a){var b=this;chrome.fileSystem.restoreEntry(a,function(a){b.setFileEntry(a),b.path=b.fileEntry.fullPath})},ha.prototype.createEditor=function(a){var b={alignLeft:{key:"W",shortKey:!0,handler:function(a,b){"left"!=b.format.align&&this.quill.formatLine(a,"align",!1)}},alignCenter:{key:"E",shortKey:!0,handler:function(a,b){"center"!=b.format.align?this.quill.formatLine(a,"align","center",!0):this.quill.formatLine(a,"align",!1)}},alignRight:{key:"R",shortKey:!0,handler:function(a,b){"right"!=b.format.align?this.quill.formatLine(a,"align","right",!0):this.quill.formatLine(a,"align",!1)}},makeHeadingOne:{key:"1",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",1,!0)}},makeHeadingTwo:{key:"2",shortKey:!0,altKey:!0,handler:function(a,b){2==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",2,!0)}},makeQuote:{key:"5",shortKey:!0,altKey:!0,handler:function(a,b){b.format.blockquote?this.quill.formatLine(a,"blockquote",!1):this.quill.formatLine(a,"blockquote",!0)}},makeCode:{key:"6",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format["code-block"]?this.quill.formatLine(a,"code-block",!1):this.quill.formatLine(a,"code-block",!0)}}};this.editor=new Quill(a,{modules:{keyboard:{bindings:b},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{align:[]}],["blockquote","code-block","link","image"],[{header:1},{header:2}]]},bounds:".main-container",theme:"bubble"});var c=this,d=this.editor;this.editorDOM=$(a).children().first();var e=this.editorDOM;ja(),1==W.statistics&&rb(d.getText());var f;this.editor.on("text-change",function(){clearTimeout(f),f=setTimeout(function(){var f,b=Ba($(a).index()),c=b.getContent();f=la(c)?e.html():d.getContents(),b.setContents(f),Eb()},1e3),c.changed=!0,1==W.statistics&&rb(c.editor.getText())}),$(a).hasClass("document-active")&&(kb(),e.children().first().focus())},ha.prototype.getEditor=function(){return this.editorDOM},ha.prototype.getDocItem=function(){return this.docListItem},ha.prototype.setActive=function(a){this.isActive=a},ha.prototype.showCreate=function(a,d,e){b.append(_),c.append(aa);var f=b.children().last();this.docListItem=f,!1===e?(c.children().last().attr("class","document-"+f.index()+" ql-container ql-bubble"),this.setActive(!1)):(b.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),c.children().removeClass("document-active"),c.children().last().attr("class","document-"+f.index()+" document-active ql-container ql-bubble"),this.setActive(!0)),this.createEditor(".document-"+f.index()),ca(f,a),da(f,d)},ha.prototype.show=function(a){b.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),c.children().removeClass("document-active"),c.children().eq(a).attr("class","document-"+a+" document-active ql-container ql-bubble"),this.editorDOM.scrollTop(this.scrollTop),this.setActive(!0),1==W.statistics&&rb(this.editor.getText()),Eb()},ha.prototype.create=function(a,b,c){this.setName(a),this.setContents(""),this.setSize(b),this.setFileEntry(!1),this.showCreate(a,b,c)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},ha.prototype.setEditorContents=function(a){if("object"==typeof a)this.editor.setContents(a);else if(la(a)){var b=oa(a);this.editorDOM.html(b)}else this.editor.setText(a);this.editor.history.clear()},ha.prototype.load=function(a,b,c,d,e){this.setName(a),this.setContents(b),this.setEditorContents(b),this.setSize(c),this.setFileEntry(d),this.changed=e},ha.prototype.loadFile=function(a,b,c,d){this.setName(a),this.setSize(b),this.setFileEntry(c),this.changed=d,ca($(".doc-active"),a),da($(".doc-active"),b)},ha.prototype.save=function(){var a=this.fileEntry,b=pa(this.name);a?sa(a):ta(b)},ha.prototype.delete=function(){var a=ba.indexOf(this);this.editorDOM.parent().remove(),this.docListItem.remove(),ba.splice(a,1),0===ba.length?(za("untitled","","0 KB",!1,!0,!1),Ma()):a-1==ba.length-1?b.children().last().click():b.children().eq(a).click()},$(document).on("keyup",".ql-editor",function(a){Ga([37,38,39,40,13].indexOf(a.keyCode)>-1),Nb(),Ia()}),$(document).on("click select",".ql-editor",function(){Ga(),Ia()}),$(".top-bar").mouseenter(function(){Lb()}),$(document).on("mouseenter",".ql-editor",function(){Nb()});var Na;f.click(function(){Na=$(Ha()),Lb(),Ja(e)}),F.click(function(){Ja(z)}),G.click(function(){Ja(A)}),i.click(function(){var a=0;h.each(function(b){var c=parseInt($(this).css("zIndex"),10);c>a&&$(this).is(":visible")&&(a=c)}),h.filter(function(){return $(this).css("z-index")==a}).each(function(){La($(this))})}),L.click(function(){La($(this).parent().parent())}),M.click(function(){za("untitled","","0 KB",!1,!0,!1),Ma()}),N.click(function(){chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:U},function(a){Ua(a)})}),O.click(function(){Ba(ea().index()).save(),Ma()}),P.click(function(){ta(Ba(ea().index()).name),Ma()}),Q.click(function(){var a=Ca().html();$("html").append('<div class="ql-editor" id="print"></div>');var c=$("#print");c.html(a),window.print(),c.remove()}),K.click(function(){Ja(E)}),H.click(function(){Ja(B,function(){B.find(".feedback-email").val($(".user-email").text()),B.find(".feedback-email").focus()})}),$(document).on("paste drop",function(){setTimeout(Xa,0)}),$(document).on("error","img",function(){$(this).hide()}),$(".submit-button").click(function(){var b=($(".feedback-email").val(),$(".feedback-subject").val()),c=$(".feedback-message").val(),d="mailto:writerchromeapp@gmail.com?subject="+b+"&body="+c,e=document.createElement("a");e.href=d,e.target="_blank",e.click()}),I.click(function(){bb(Ba(ea().index()),Ja(C))}),J.click(function(){Ja(D)}),R.css("bottom","-"+(R.height()+100)+"px");var db;$(document).on("click",".document-item",function(){var a=$(this).index(),b=Ba(a);ua(),b.show(a),Ma()}),l.click(function(){var a=$(this).attr("name");gb($(this))?(fa($(this),"toggle-active","toggle-inactive"),X(a,!1)):(fa($(this),"toggle-inactive","toggle-active"),X(a,!0))}),l.mousedown(function(){$(this).children().css("transform","scale(1.15, .85)"),$(this).children().css("box-shadow","rgba(0, 0, 0, 0.1) 0px 0px 0px 8px")}),$(document).mouseup(function(){l.children().css("transform","none"),l.children().css("box-shadow","none")});var hb="/assets/settings/coffee.mp3",ib=new Audio(hb);m.click(function(){gb($(this))?ib.play():ib.pause()});var jb;n.click(function(){kb(),!1===gb($(this))?nb("night.css"):mb("night.css")}),o.click(function(){chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()});var qb;q.click(function(){!1===gb($(this))?(qb=!1,$(".ql-editor *").css("opacity","1")):(qb=!0,void 0===Na&&(Na=Ca().children().first()),Ea(Na))}),S.css("bottom","-"+(S.height()+100)+"px"),p.click(function(){!1===gb($(this))?tb():sb()}),t.click(function(){var a=$(this).text();$(".ql-editor").css("font-family",a),X("font",a)}),u.click(function(){var a=$(this).text();$(".ql-editor").css("font-size",ub(a)),X("size",a)}),v.click(function(){var a=$(this).text();switch(a){case"Default":nb("dark.css"),nb("turquoise.css");break;case"Dark":mb("dark.css"),nb("turquoise.css");break;case"Turquoise":mb("turquoise.css"),nb("dark.css")}X("theme",a)}),w.click(function(){var a=$(this).text(),b=a;"Single"==a&&(b=1),"Double"==a&&(b=2),$(".ql-editor").css("line-height",b),X("line",a)}),y.click(function(){var a=$(this).text(),b=a;switch(a){case"Small":b="8%";break;case"Medium":b="18%";break;case"Large":b="26%"}vb(b),X("margin",a)}),r.click(function(){if($(this).hasClass("noToggle")){var a=$(this).children().last();a.is(":visible")?xb(a):wb(a)}}),s.children().click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}),$(document).on("click",".document-edit",function(a){a.stopImmediatePropagation(),a.stopPropagation();var b=$(this).parent().find("input"),c=b.parent().index(),d=b.val(),e=Ba(c);"check"==$(this).text()?(yb(b,$(this)),d==e.name||(e.setFileEntry(null),e.setName(d))):zb(b,$(this)),Ab($(this).find(".material-icons"))}),$(document).on("keyup",".document-title",function(a){var b=$(this).parent().index(),c=Ba(b),d=$(this).val();13==a.keyCode&&(yb($(this),$(this).parent()),Ab($(this).parent().find(".document-edit").find(".material-icons")),d==c.name||(c.setFileEntry(null),c.setName(d)))}),$(document).on("click",".document-title",function(a){void 0===$(this).attr("readonly")&&(a.stopImmediatePropagation(),a.stopPropagation())}),$(document).on("click",".document-delete",function(a){a.stopPropagation();var b=$(this).parent().index(),c=Ba(b);c.changed?Bb($(this).parent()):Aa(c)}),$(document).on("click",".delete-confirm",function(a){a.stopPropagation(),Aa(Ba($(this).parent().parent().index()))}),$(document).on("click",".delete-cancel",function(a){a.stopPropagation(),Cb($(this).parent().parent())}),$(document).on("click",".ql-editor img",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var Jb;$(".signin-button").click(function(){Ib(!0,Yb)}),$(".fallback-signin").click(function(){Ib(!1)}),$(".continue-button").click(function(){k.stop().animate({top:"-100%"},400,T,function(){$(this).remove(),Yb()}),Wb({installed:!0,signIn:!1})});var Mb;Lb(),document.addEventListener("scroll",function(a){Ba(ea().index()).scrollTop=Ca().scrollTop()},!0),$(document).on("keydown",function(a){var b=Qb(a),c=Rb(a),d=Sb(a),e=b&&!c&&Pb(a,78),f=b&&!c&&Pb(a,79),g=b&&!c&&!d&&Pb(a,83),h=b&&c&&!d&&Pb(a,83),i=b&&Pb(a,80),j=Pb(a,122),k=b&&c&&Pb(a,78),l=b&&c&&Pb(a,70),m=b&&d&&!c&&Pb(a,83),o=b&&d&&Pb(a,81),r=b&&Pb(a,191),s=Pb(a,27);if(e&&(a.preventDefault(),M.click()),f&&N.click(),g&&O.click(),h&&P.click(),i&&Q.click(),j&&(chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()),k&&(a.preventDefault(),n.click()),l&&q.click(),m&&p.click(),s&&(a.preventDefault(),$b()),r&&(D.is(":visible")?(Nb(),La(D)):(Lb(),Ja(D))),o)if(z.is(":visible"))$(".doc-active").find(".delete-confirm").click();else{var t=Ba(ea().index());t.changed?Ja(z,$(".doc-active").find(".document-delete").click()):$(".doc-active").find(".document-delete").click()}}),$(".feedback-message").on("keydown keyup change",function(){$(this).css("height","auto"),$(this).css("height",this.scrollHeight+"px")}),chrome.runtime.onMessage.addListener(function(a,b,c){(a.max||a.min||a.restored)&&pb(),a.full&&ob(),a.open&&Zb()}),$(".sign-out").css({height:"0",display:"none"}),$(".arrow-down").click(function(){$(".sign-out").is(":visible")?Ub():Tb()}),$(".sign-out").click(function(){Hb(),Ub(),Vb(),Wb({signIn:!1})}),Kb(Yb),$(".close-window").click(function(){$b()}),$(".maximize-window").click(function(){chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}),$(".minimize-window").click(function(){chrome.app.window.current().minimize()})});
