$(document).ready(function(){function ba(a,b){aa[a]=b,Sb()}function ca(a){return a.charAt(0).toUpperCase()+a.slice(1)}function da(a){aa=a;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=["font","size","theme","margin","line"];if(d.indexOf(b)>-1){var e;e="size"==b?".font-"+b+"-options":"."+b+"-options",$(e).children().removeClass("active"),$(e).children().filter(function(){return $(this).text()==ca(c)}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},400)})}else c=!1===c?"toggle-inactive":"toggle-active","focus"==b&&"toggle-inactive"==c&&(Eb=!1,$(".ql-editor *").css("opacity","1")),"toggle-active"==c&&$("."+b).click()}ka().click()}function ha(a,b){a.find(".document-title").val(b)}function ia(a,b){a.find(".document-size").text(b)}function ja(a){return a?$(".document-active").index():$(".document-active")}function ka(){return $(".doc-active")}function la(a,b,c){a.removeClass(b),a.addClass(c)}function na(){this.name,this.size,this.contents,this.fileEntry,this.savedFileEntry,this.isActive,this.editor,this.editorDOM,this.docListItem,ma=this}function oa(a){var c=$(document.createElement("div"));c.addClass("temporary-editor"),b.append(c);var d=new Quill(".temporary-editor");c.children().first().html(a);var f=d.getContents();return c.remove(),f}function pa(){v.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),w.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),z.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)}),A.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){u.css("height","0"),u.hide()},200)})}function ra(a){return/<[\s\S]*>/i.test(a)}function sa(a){return!$.trim(a.html())}function ta(a){return a.replaceAll(' 0.6;"=""',"").replaceAll(' 1;"=""',"").replaceAll("=3D","=").replaceAll('="3D','="').replaceAll('class="3D&quot;','class="').replaceAll("&quot;","")}function ua(a,b,c){var d=a.length;if(0==d)return[];var f,e=0,g=[];for(c||(b=b.toLowerCase(),a=a.toLowerCase());(f=b.indexOf(a,e))>-1;)g.push(f),e=f+d;return g}function va(a,b,c){ua(c,a).forEach(function(a,c,d){if(b<a)return a})}function wa(a,b){var c=a.attr("style"),d=c.lastIndexOf(b+":")+b.length+2;return c=c.substring(d,va(c,d,":")),c=c.replace(";","")}function xa(a){var b=$(document.createElement("div"));b.addClass("htmlParent"),b.html(a),b.find("br").remove(),b.find("*").each(function(){if(sa($(this))&&$(this).html("<br/>"),$(this).attr("style")&&$(this).attr("style").indexOf("text-align")>-1){var a=wa($(this),"text-align");$(this).addClass("ql-align-"+a),$(this).removeAttr("style")}}),b.find("ol, ul").each(function(){var a=$(this).parentsUntil(b).length-1;if(-1!=a&&$(this).children().not("ol").not("ul").attr("class","ql-indent-"+a),!$(this).parent().is(b)){var c=$(this).contents();$(this).replaceWith(c)}}),b.find("li").each(function(){$(this).find("li").length&&$(this).find("li").insertAfter($(this))}),b.find("div").each(function(){$(this).replaceWith("<p>"+$(this).html()+"</p>")}),b.find("span").each(function(){var a=$(this).contents();$(this).replaceWith(a)}),b.find("p").each(function(){if($(this).parent().is("li")||$(this).parent().is("blockquote")){var a=$(this).contents();$(this).replaceWith(a)}}),b.find("table").remove();var c=ta(b.html());return console.log(c),c}function ya(a){return-1==a.indexOf(".")?a:a.substr(0,a.lastIndexOf("."))}function Aa(a){$a(!0),k.is(":visible")||Xa(),$(".save-dialogue .save-text span").text(a.name),$(".save-dialogue").fadeIn("fast"),za=ga.indexOf(a)}function Ba(){$a(),$(".save-dialogue").fadeOut("fast")}function Ca(a){var b=$(document.createElement("div"));return b.html(a),b.find("*").removeAttr("style"),b.html()}function Da(a,b,c,d){a.write(c),b.loadFile(d.name,c.size,d,!1),sb(!1,!1,d.name),Sb()}function Ea(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(b){var e,f,c=Qa(a.name),d=Na(ja(!0));switch(c){case"html":case"htm":case"wtr":e=Ca(Oa().html()),f=new Blob([e]),Da(b,d,f,a);break;case"md":require(["upndown"],function(c){(new c).convert(Ca(Oa().html()),function(c,g){c?console.log(c):(e=g,f=new Blob([e]),Da(b,d,f,a))})});break;case"docx":e="<!DOCTYPE HTML><html><head></head><body>"+Ca(Oa().html())+"</body></html>",f=htmlDocx.asBlob(e),Da(b,d,f,a);break;case"pdf":f=pdfBlob,Da(b,d,f,a);break;case"txt":default:e=d.editor.getText(),f=new Blob([e]),Da(b,d,f,a)}var g=!1;b.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)}})}):console.log("User cancelled saving.")}function Fa(a){a=ya(a),window.navigator.userAgent.indexOf("CrOS")>-1&&(a+=".wtr"),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,accepts:Z},Ea)}function Ga(){ga.forEach(function(a,b,c){Na(b).setActive(!1)})}function Ha(a){Na(a).editor.focus()}function Ia(a){ga.push(a)}function Ja(a,b,c,d){a.create(b,c,d)}function Ka(a,b,c,d,e,f){a.load(b,c,d,e,f)}function La(a,b,c,d,e,f,g){var h=new na;0!=a&&(b="untitled",c="",d="0 KB",e=!1,f=!0,g=!1),Ja(h,b,d,f),Ka(h,b,c,d,e,g),Ia(h),jb(),Sb()}function Ma(a){a.delete()}function Na(a){return ga[a]}function Oa(){return $(".document-active .ql-editor")}function Pa(){return $(".ql-editor")}function Qa(a){return a.substring(a.lastIndexOf(".")+1,a.length)}function Ra(a){"li"==a.get(0).nodeName.toLowerCase()?(Oa().find("*").css("opacity","0.6"),a.parent().css("opacity","1"),a.parent().children().css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1")):(Oa().find("*").css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1"))}function Sa(a){a=a||window;var d,e,f,b=a.document,c=b.selection,g=0;return c?"Control"!=c.type&&(d=c.createRange(),d.collapse(!0),x=d.boundingLeft,g=d.boundingTop):a.getSelection&&(c=a.getSelection(),c.rangeCount&&(d=c.getRangeAt(0).cloneRange(),d.getClientRects&&(d.collapse(!0),e=d.getClientRects(),e.length>1&&(f=e[1]),void 0===f&&void 0===(f=e[0])&&(f=Ua(),$(f).hasClass("ql-editor")||(f=f.getClientRects()[0])),g=f.top))),{y:g}}function Ta(a){setTimeout(function(){var b=Oa(),c=b.scrollTop(),d=Sa(),e=c+d.y-b.height()/2-100;a?b.stop().animate({scrollTop:e},300,Y,function(){Na(ja(!0)).scrollTop=e}):b.filter(":not(:animated)").animate({scrollTop:e},300,Y,function(){Na(ja(!0)).scrollTop=e})},1)}function Ua(){var a,b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount>0&&(a=b.getRangeAt(0))),a)return c=a.commonAncestorContainer,3===c.nodeType?c.parentNode:c}function Va(){if(!1===Eb);else{var a=Ua(),b=a.nodeName.toLowerCase(),c=["h1","h2","h3","h4","h5","h6","p","blockquote","pre","li"];if($(a).hasClass("ql-editor"));else if(-1==c.indexOf(b)){for(;-1==c.indexOf(b);)a=$(a).parent(),b=a.prop("tagName").toLowerCase();Ra($(a))}else Ra($(a))}}function Wa(a,b){a==B&&bb(),Oa().blur(),window.getSelection().removeAllRanges(),k.is(":visible")?a.show().filter(":not(:animated)").animate({left:"0"},200,Y,function(){b&&b()}):k.show().filter(":not(:animated)").animate({opacity:"0.5"},200,Y,function(){a.show().filter(":not(:animated)").animate({left:"0"},200,Y)})}function Xa(){k.show().filter(":not(:animated)").animate({opacity:"0.5"},200)}function Ya(){k.filter(":not(:animated)").animate({opacity:"0"},200,Y,function(){$(this).hide(),Ha(ja(!0)),Va();var a=Na(ja(!0)).scrollTop;ja().children().first().scrollTop(a)})}function Za(a){a.filter(":not(:animated)").animate({left:"-"+a.width()},200,Y,function(){$(this).hide()}),1==j.filter(function(){return $(this).is(":visible")}).length&&Ya()}function $a(a){Za(j),1!=a&&Ya()}function ab(a){var c,d,b=Qa(a.name),e=ga.indexOf(a),f=$(".document-"+e).find(".ql-editor").html();switch(b){case"html":case"htm":case"wtr":c=f,d=new Blob([c]);break;case"md":c=toMarkdown(f),d=new Blob([c]);break;case"docx":c="<!DOCTYPE HTML><html><head></head><body>"+f+"</body></html>",d=htmlDocx.asBlob(c);break;case"txt":default:c=a.editor.getText(),d=new Blob([c])}return Math.floor(d.size/1e3)}function bb(){d.children().each(function(){var a=Na($(this).index()),b=ab(a);a.setSize(b+" KB"),ia($(this),b+" KB")})}function cb(a,b){var c=new FileReader;c.onload=function(){var d=this.result;if(d.indexOf('<w:altChunk r:id="htmlChunk" />')>-1)d=d.substring(d.lastIndexOf("<!DOCTYPE HTML><html><head></head><body>")+15,d.lastIndexOf("</body></html>")),La(!1,a.name,d,a.size,b,!0,!1),$a();else{new FileReader;c.onload=function(){var c=this.result;mammoth.convertToHtml({arrayBuffer:c}).then(function(d){c=d.value,La(!1,a.name,c,a.size,b,!0,!1),$a()}).done()},c.readAsArrayBuffer(a)}},c.readAsText(a)}function db(a){return a.replace(/\n\n  \n\n\n/g,"<p><p>")}function eb(a,b,c){var d=new FileReader;d.onload=function(){var d=this.result;console.log(d),c?(d=db(d),d=marked(d),d=xa(d),La(!1,a.name,d,a.size,b,!0,!1),$a()):(La(!1,a.name,d,a.size,b,!0,!1),$a())},d.readAsText(a)}function fb(a){for(var b=0;b<ga.length;b++)if(ga[b].path==a)return!0;return!1}function gb(a){a.forEach(function(a,b,c){var d=a;1==fb(d.fullPath)?($a(),sb(!0,"is already open.",d.name)):d.file(function(a){switch(Qa(a.name)){case"md":eb(a,d,!0);break;case"docx":cb(a,d);break;case"html":case"htm":case"txt":case"wtr":default:eb(a,d,!1)}})})}function hb(a,b){var c=new FileReader;c.onload=function(){var a=this.result;void 0!=b&&b.attr("src",a)},c.readAsDataURL(a)}function ib(a,b){if(-1==a.indexOf("data:")){var c=new XMLHttpRequest;c.open("GET",a),c.responseType="blob",c.onload=function(){hb(c.response,b)}.bind(this),c.send()}b.show()}function jb(){Oa().find("img").each(function(){if(void 0===$(this).attr("src"));else{ib($(this).attr("src"),$(this))}})}function kb(a){var b=mb(a);return Math.round(b/200)+" Min"}function lb(a){return a.replace(/\n$/gm,"").split(/\n/).length}function mb(a){var b=a.trim().replace(/\s+/gi," ").split(" ");return b=""===b[0]&&1==b.length?0:b.length}function nb(a){return a.length-1}function ob(a){return null===a.match(/[\S]/g)?0:a.match(/[\S]/g).length}function pb(a,b){var c=a.editor.getText();qb({name:a.name,time:kb(c),paragraphs:lb(c),words:mb(c),chars:nb(c),charsExSpaces:ob(c)},b)}function qb(a,b){var c=0;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];switch(d){case"name":$(".file-name-details").text(e);break;case"time":$(".est-time-amount").text(e);break;case"paragraphs":$(".paragraph-amount").text(e);break;case"words":$(".word-amount").text(e);break;case"chars":$(".character-amount").text(e);break;case"charsExSpaces":$(".characters-without-spaces-amount").text(e)}c++,c===a.length&&b()}}function sb(a,b,c){a||b?(T.children().first().text(c),T.children("span").text(b),T.show().stop().animate({bottom:"0"},500,Y,function(){rb=setTimeout(tb,5e3)})):(T.children().first().text(c),T.children("span").text("was saved."),T.show().stop().animate({bottom:"0"},500,Y,function(){rb=setTimeout(tb,3e3)}))}function tb(){T.animate({bottom:"-"+(T.height()+100)+"px"},500,Y,function(){$(this).hide(),clearTimeout(rb)})}function ub(a){return a.hasClass("toggle-active")}function yb(){Pa().css("transition","none"),$(".ql-editor *").css("transition","none"),clearTimeout(xb),xb=setTimeout(function(){zb()},200)}function zb(){Pa().css("transition","all .2s ease"),$(".ql-editor *").css("transition","all .2s ease")}function Ab(a){var b='<link type="text/css" rel="stylesheet" href="assets/settings/themes/'+a+'"/>';$('link[href="'+a+'"]').length<1&&$("head").append(b)}function Bb(a){$('link[href="assets/settings/themes/'+a+'"]').remove()}function Cb(){var a=q.attr("name");la(q,"toggle-inactive","toggle-active"),ba(a,!0)}function Db(){var a=q.attr("name");la(q,"toggle-active","toggle-inactive"),ba(a,!1)}function Fb(a){var b=$(".words"),c=$(".chars"),d=/\s+/gi,e=a.trim().replace(d," ").split(" "),f=a.length-1;e=""===e[0]&&1==e.length?0:e.length,b.text(e),c.text(f)}function Gb(){Fb(Na(ja(!0)).editor.getText()),U.show().stop().animate({bottom:"0"},300,Y)}function Hb(){U.stop().animate({bottom:"-"+(U.height()+50)+"px"},300,Y,function(){$(this).hide()})}function Ib(a){return Number(a.replace("px",""))/12+.25+"em"}function Jb(a){Pa().css("padding-left",a),Pa().css("padding-right",a)}function Kb(){$(".toggle").each(function(){$(this).hasClass("toggle-active")&&"focus"!=$(this).attr("name")&&$(this).click()}),$(".default-theme").click(),$(".charter").click(),$(".16px").click(),$(".double-line").click(),$(".medium-margin").click(),u.each(function(){$(this).css("height","0px"),$(this).hide()})}function Lb(a){var b=40*a.children().length+"px";a.stop().show().animate({height:b},400,Y)}function Mb(a){a.stop().animate({height:"0"},400,Y,function(){$(this).hide()})}function Nb(a){a.attr("readonly",!0),a.blur()}function Ob(a){a.attr("readonly",!1),a.select()}function Pb(a){a.show().stop().animate({height:"120px"},300,Y)}function Qb(a,b){a.stop().animate({height:"0"},300,Y,function(){$(this).hide()}),b&&b()}function Rb(){setTimeout(function(){if(1==aa.statistics){Fb(Na(ja(!0)).editor.getText())}l.stop().animate({top:"-100%"},800,Y,function(){$(this).remove()})},800)}function Sb(){ic({settings:aa,data:ga})}function Tb(a,b){var c=new XMLHttpRequest;c.onload=function(){var a=new FileReader;a.onloadend=function(){b(a.result)},a.readAsDataURL(c.response)},c.open("GET",a),c.responseType="blob",c.send()}function Ub(a){var c=a;return 255-(.299*c.r+.587*c.g+.114*c.b)<105?"#000000":"#ffffff"}function Vb(){chrome.identity.removeCachedAuthToken({token:Xb},function(){});var a=new XMLHttpRequest;a.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+Xb),a.send()}function Wb(a,b){navigator.onLine?chrome.identity.getAuthToken({interactive:!0},function(c){Xb=c,chrome.runtime.lastError?!1===a?Vb():(Rb(),m.show(),ic({installed:!1})):$.get("https://www.googleapis.com/plus/v1/people/me?access_token="+c,function(a){var c=a.cover.coverPhoto.url,d=a.image.url,e=a.displayName;Tb(d,function(a){$(".user-image").css("background-image","url("+a+")");var c=document.createElement("img");c.setAttribute("src",a),c.addEventListener("load",function(){var a=new Vibrant(c),d=a.DarkMutedSwatch.rgb,e=d.join(","),f=Ub(d);$(".user-info").css("color",f),$(".fallback-signin").hide(),$(".sign-out").css({backgroundColor:"rgb("+e+")",color:f}),$(".sign-out .material-icons").css("color",f),$(".user-profile-body").show(),ic({installed:!0,signIn:!0}),b&&(m.stop().animate({top:"-100%"},800,Y,function(){$(this).remove()}),b())})}),Tb(c,function(a){$(".user-profile").css("background-image","url("+a+")")}),$(".user-name").text(e),chrome.identity.getProfileUserInfo(function(a){$(".user-email").text(a.email)})}).fail(function(){Vb()})}):(m.hide(),lc())}function Yb(a){jc({installed:"installed",signIn:"signIn"},function(a){var b=a.installed,c=a.signIn;"installed"==b||!1===b||"signIn"==c?(Rb(),m.show()):!1===c?lc():Wb(!1,lc)})}function Zb(){clearTimeout($b),f.stop().animate({top:"0"},400,Y),e.css("margin-top","30px"),e.css("height","calc(100% - 30px)"),j.css("margin-top","30px"),j.css("height","calc(100% - 30px)")}function _b(){clearTimeout($b),$b=setTimeout(function(){f.stop().animate({top:"-30px"},400,Y),e.css("margin-top","0px"),e.css("height","100%"),j.css("margin-top","0px"),j.css("height","100%")},1e3)}function ac(){var a="Unknown OS",b=navigator.appVersion;return-1!=b.indexOf("Win")&&(a="Windows"),-1!=b.indexOf("Mac")&&(a="MacOS"),-1!=b.indexOf("X11")&&(a="UNIX"),-1!=b.indexOf("Linux")&&(a="Linux"),a}function bc(a,b){return a.keyCode==b}function cc(a){return"MacOS"==ac()?a.metaKey:a.ctrlKey}function dc(a){return a.shiftKey}function ec(a){return a.altKey}function fc(){$(".arrow-down .material-icons").css("transform","rotate(180deg)"),$(".sign-out").show().stop().animate({height:"60px"},200,Y)}function gc(){$(".arrow-down .material-icons").css("transform","rotate(0deg)"),$(".sign-out").stop().animate({height:"0px"},200,Y,function(){$(this).hide()})}function hc(){$(".user-profile").css("background-image","url(../assets/sidebar/fallback.png)"),$(".user-profile-body").hide(),$(".fallback-signin").show()}function ic(a,b){chrome.storage.local.set(a,b)}function jc(a,b){chrome.storage.local.get(a,b)}function kc(){$(".tutorial-container").fadeOut("fast",function(){Oa().blur(),window.getSelection().removeAllRanges(),$(".tutorial-container-two").fadeIn("fast")})}function lc(){jc({settings:"settings",data:"documents"},function(a){var b=a.settings,c=a.data;if("settings"==b||"documents"==c)$(".tutorial-container").fadeIn("fast"),La(!0),da(_),Rb();else{var d=0;0===c.length?(La(!0),da(b),Rb()):c.forEach(function(a,e,f){var g=c[e];La(!1,g.name,g.contents,g.size,g.savedFileEntry,g.isActive,g.changed),ja().children().first().children().css("opacity","0.6"),ja().children().first().children().first().css("opacity","1"),++d===f.length&&(mc(),da(b),Rb())})}})}function mc(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),gb(b)}}function nc(){chrome.app.window.current().close()}service=analytics.getService("Writer"),service.getConfig().addCallback(function(a){a.setTrackingPermitted(!0)}),tracker=service.getTracker("UA-96857701-1"),tracker.sendAppView("MainView"),require.config({paths:{upndown:"/assets/libs/upndown/lib/upndown.bundle.min"}});var a=$("html"),b=$("body"),c=$(".top-bar"),d=$(".document-list"),e=$(".main-container"),f=$(".navigation-container"),g=$(".sidebar"),h=$(".sidebar-toggle"),j=($(".settings-container"),$(".modal")),k=$(".bg"),l=$(".loading-screen"),m=$(".install-screen"),n=$(".toggle"),o=$(".coffee"),p=$(".night"),q=$(".full"),r=$(".statistics"),s=$(".focus"),t=$(".settings-option"),u=$(".option"),v=$(".font-options").children(),w=$(".font-size-options").children(),y=$(".theme-options").children(),z=$(".line-options").children(),A=$(".margin-options").children(),B=$(".document-container"),C=$(".settings-container"),D=$(".feedback-container"),E=$(".details-container"),F=$(".help-container"),G=$(".file-container"),H=$(".open-documents"),I=$(".open-settings"),J=$(".open-feedback"),K=$(".open-details"),L=$(".open-help"),M=$(".open-file"),N=$(".modal-close"),O=$(".new"),P=$(".open"),Q=$(".save"),R=$(".save-as"),S=$(".print"),T=$(".snackbar"),U=$(".statistics-bar"),V=$(".feedback-email"),W=$(".feedback-email"),X=$(".feedback-message"),Y=$.bez([.17,.67,.29,1.01]),Z=[{description:"Writer Document (*.wtr)",extensions:["wtr"]},{description:"Word Document (*.docx)",extensions:["docx"]},{description:"Markdown File (*.md)",extensions:["md"]},{description:"HTML File (*.html)",extensions:["html"]},{description:"HTM File (*.htm)",extensions:["htm"]},{description:"Text File (*.txt)",extensions:["txt"]}],_={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"double",margin:"medium"},aa={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"double",margin:"medium"},ea='<div class="document-item"><div class="material-icons">insert_drive_file</div><input readonly=true class="document-title" type="text"/><div class="doc-overflow"><div class="material-icons">more_vert</div></div><div class="overflow-menu"><div class="doc-rename">Rename</div><div class="doc-delete">Delete</div></div><div class="document-size"></div></div>',fa='<div class="document document-active"></div>';$(".sidebar, .settings-container, .document-container, .bg, .option, .snackbar").hide();var ma,ga=[];na.prototype.setName=function(a){this.name=a},na.prototype.getName=function(){return this.name},na.prototype.setContents=function(a){ra(a)&&(a=oa(a)),this.contents=a},na.prototype.getContent=function(){return this.contents},na.prototype.setSize=function(a){this.size=a},na.prototype.getSize=function(){return this.size},na.prototype.setFileEntry=function(a){"string"==typeof a?this.loadFileEntry(a):(this.fileEntry=a,null===a||void 0===a||!1===a||(this.path=this.fileEntry.fullPath,this.setName(a.name),this.setSavedFileEntry(a)))},na.prototype.getFileEntry=function(){return this.fileEntry},na.prototype.setSavedFileEntry=function(a){this.savedFileEntry=chrome.fileSystem.retainEntry(a)},na.prototype.getSavedFileEntry=function(){return this.savedFileEntry},na.prototype.loadFileEntry=function(a){var b=this;chrome.fileSystem.restoreEntry(a,function(a){b.setFileEntry(a),b.path=b.fileEntry.fullPath})},na.prototype.createEditor=function(a){var b={alignLeft:{key:"W",shortKey:!0,handler:function(a,b){"left"!=b.format.align&&this.quill.formatLine(a,"align",!1)}},alignCenter:{key:"E",shortKey:!0,handler:function(a,b){"center"!=b.format.align?this.quill.formatLine(a,"align","center",!0):this.quill.formatLine(a,"align",!1)}},alignRight:{key:"R",shortKey:!0,handler:function(a,b){"right"!=b.format.align?this.quill.formatLine(a,"align","right",!0):this.quill.formatLine(a,"align",!1)}},makeHeadingOne:{key:"1",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",1,!0)}},makeHeadingTwo:{key:"2",shortKey:!0,altKey:!0,handler:function(a,b){2==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",2,!0)}},makeQuote:{key:"5",shortKey:!0,altKey:!0,handler:function(a,b){b.format.blockquote?this.quill.formatLine(a,"blockquote",!1):this.quill.formatLine(a,"blockquote",!0)}},makeCode:{key:"6",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format["code-block"]?this.quill.formatLine(a,"code-block",!1):this.quill.formatLine(a,"code-block",!0)}}};this.editor=new Quill(a,{modules:{keyboard:{bindings:b},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{align:[]}],["blockquote","code-block","link","image"],[{header:1},{header:2}]]},bounds:".main-container",theme:"bubble"});var c=this,d=this.editor;this.editorDOM=$(a).children().first();var e=this.editorDOM;pa(),1==aa.statistics&&Fb(d.getText());var f;this.editor.on("text-change",function(){clearTimeout(f),f=setTimeout(function(){var f,b=Na($(a).index()),c=b.getContent();f=ra(c)?e.html():d.getContents(),b.setContents(f),Sb()},600),c.changed=!0,1==aa.statistics&&Fb(c.editor.getText()),$(".tutorial-container").is(":visible")&&kc()}),$(a).hasClass("document-active")&&(yb(),e.children().first().focus())},na.prototype.getEditor=function(){return this.editorDOM},na.prototype.getDocItem=function(){return this.docListItem},na.prototype.setActive=function(a){this.isActive=a},na.prototype.showCreate=function(a,b,c){d.append(ea),e.append(fa);var f=d.children().last();this.docListItem=f,!1===c?(e.children().last().attr("class","document-"+f.index()+" ql-container ql-bubble"),this.setActive(!1)):(d.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),e.children().removeClass("document-active"),e.children().last().attr("class","document-"+f.index()+" document-active ql-container ql-bubble"),this.setActive(!0)),this.createEditor(".document-"+f.index()),ha(f,a),ia(f,b)},na.prototype.show=function(a){d.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),e.children().removeClass("document-active"),e.children().eq(a).attr("class","document-"+a+" document-active ql-container ql-bubble"),this.editorDOM.scrollTop(this.scrollTop),this.setActive(!0),1==aa.statistics&&Fb(this.editor.getText()),Sb()},na.prototype.create=function(a,b,c){this.setName(a),this.setContents(""),this.setSize(b),this.setFileEntry(!1),this.showCreate(a,b,c)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},na.prototype.setEditorContents=function(a){if("object"==typeof a)this.editor.setContents(a);else if(ra(a)){var b=xa(a);this.editorDOM.html(b)}else this.editor.setText(a);this.editor.history.clear()},na.prototype.load=function(a,b,c,d,e){this.setName(a),this.setContents(b),this.setEditorContents(b),this.setSize(c),this.setFileEntry(d),this.changed=e},na.prototype.loadFile=function(a,b,c,d){this.setName(a),this.setSize(b),this.setFileEntry(c),this.changed=d,ha(ka(),a),ia(ka(),b)},na.prototype.save=function(){var a=this.fileEntry,b=ya(this.name);a?Ea(a):Fa(b)};var za;$(".save-buttons .delete-cancel").click(function(){Ba()}),$(".save-buttons .delete-confirm").click(function(){var a=Na(za);a.changed=!1,a.delete(),Ba()}),na.prototype.delete=function(){if(this.changed)Aa(this);else{var a=ga.indexOf(this);this.editorDOM.parent().remove(),this.docListItem.remove(),ga.splice(a,1),0===ga.length?(La(!0),$a()):a-1==ga.length-1?d.children().last().click():d.children().eq(a).click()}},$(document).on("keyup",".ql-editor",function(a){Ta([37,38,39,40,13].indexOf(a.keyCode)>-1),_b(),Va()}),$(document).on("click select",".ql-editor",function(){Ta(),Va()}),c.mouseenter(function(){Zb()}),$(document).on("mouseenter",".ql-editor",function(){_b()});var _a;h.click(function(){_a=$(Ua()),$(".tutorial-container-two").fadeOut("fast"),Zb(),Wa(g)}),H.click(function(){Wa(B)}),I.click(function(){Wa(C)}),k.click(function(){if(!$(".save-dialogue").is(":visible")){var a=0;j.each(function(b){var c=parseInt($(this).css("zIndex"),10);c>a&&$(this).is(":visible")&&(a=c)}),j.filter(function(){return $(this).css("z-index")==a}).each(function(){Za($(this))})}}),N.click(function(){Za($(this).parent().parent())}),O.click(function(){La(!0),$a()}),P.click(function(){chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:Z},function(a){gb(a)})}),Q.click(function(){Na(ja(!0)).save(),$a()}),R.click(function(){Fa(Na(ja(!0)).name),$a()}),S.click(function(){var b=Oa().html();a.append('<div class="ql-editor" id="print"></div>');var d=$("#print");d.html(b),window.print(),d.remove()}),M.click(function(){Wa(G)}),J.click(function(){Wa(D,function(){D.find(".feedback-email").val($(".user-email").text()),D.find(".feedback-email").focus()})}),$(document).on("paste drop",function(){setTimeout(jb,0)}),$(document).on("error","img",function(){$(this).hide()}),$(".submit-button").click(function(){var b=(V.val(),W.val()),c=X.val(),d="mailto:writerchromeapp@gmail.com?subject="+b+"&body="+c,e=document.createElement("a");e.href=d,e.target="_blank",e.click()}),K.click(function(){pb(Na(ja(!0)),Wa(E))}),L.click(function(){Wa(F)}),T.css("bottom","-"+(T.height()+100)+"px");var rb;$(document).on("click",".document-item",function(){if($(".overflow-menu").is(":visible"))Qb($(".overflow-menu"));else{var a=$(this).index(),b=Na(a);Ga(),b.show(a),$a()}}),n.click(function(){var a=$(this).attr("name");ub($(this))?(la($(this),"toggle-active","toggle-inactive"),ba(a,!1)):(la($(this),"toggle-inactive","toggle-active"),ba(a,!0))}),n.mousedown(function(){$(this).children().css("transform","scale(1.15, .85)"),$(this).children().css("box-shadow","rgba(0, 0, 0, 0.1) 0px 0px 0px 8px")}),$(document).mouseup(function(){n.children().css("transform","none"),n.children().css("box-shadow","none")});var vb="/assets/settings/coffee.mp3",wb=new Audio(vb);o.click(function(){ub($(this))?wb.play():wb.pause()});var xb;p.click(function(){yb(),!1===ub($(this))?Bb("night.css"):Ab("night.css")}),q.click(function(){chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()});var Eb;s.click(function(){!1===ub($(this))?(Eb=!1,$(".ql-editor *").css("opacity","1")):(Eb=!0,void 0===_a&&(_a=Oa().children().first()),Ra(_a))}),U.css("bottom","-"+(U.height()+100)+"px"),r.click(function(){!1===ub($(this))?Hb():Gb()}),v.click(function(){var a=$(this).text();Pa().css("font-family",a),ba("font",a)}),w.click(function(){var a=$(this).text();Pa().css("font-size",Ib(a)),ba("size",a)}),y.click(function(){var a=$(this).text();switch(a){case"Default":Bb("dark.css"),Bb("turquoise.css");break;case"Dark":Ab("dark.css"),Bb("turquoise.css");break;case"Turquoise":Ab("turquoise.css"),Bb("dark.css")}ba("theme",a)}),z.click(function(){var a=$(this).text(),b=a;"Single"==a&&(b=1),"Double"==a&&(b=2),Pa().css("line-height",b),ba("line",a)}),A.click(function(){var a=$(this).text(),b=a;switch(a){case"Small":b="8%";break;case"Medium":b="18%";break;case"Large":b="26%"}Jb(b),ba("margin",a)}),$(".reset-button").click(function(){Kb()}),t.click(function(){if($(this).hasClass("noToggle")){var a=$(this).children().last();a.is(":visible")?Mb(a):("0px"!=a.css("height")&&a.css("height","0px"),Lb(a))}}),u.children().click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}),$(document).on("click",".doc-overflow",function(a){a.stopPropagation();var b=$(this).parent().find(".overflow-menu");Qb($(".overflow-menu"),function(){Pb(b)})}),$(document).on("click",".document-title",function(a){void 0===$(this).attr("readonly")&&(a.stopImmediatePropagation(),a.stopPropagation())}),$(document).on("click",".doc-delete",function(a){a.stopPropagation(),Ma(Na($(this).parent().parent().index()))}),$(document).on("click",".doc-rename",function(){Ob($(this).parent().parent().find("input"))}),$(document).on("keyup",".document-title",function(a){var b=$(this).parent().index(),c=Na(b),d=$(this).val();13==a.keyCode&&(Nb($(this)),d==c.name||(c.setFileEntry(null),c.setName(d)))}),$(document).on("click",function(){Qb($(".overflow-menu"))}),$(document).on("click",".ql-editor img",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var Xb;$(".signin-button").click(function(){Wb(!0,lc)}),$(".fallback-signin").click(function(){Wb(!1)}),$(".continue-button").click(function(){m.stop().animate({top:"-100%"},400,Y,function(){$(this).remove(),lc()}),ic({installed:!0,signIn:!1})});var $b;Zb(),document.addEventListener("scroll",function(a){Na(ja(!0)).scrollTop=Oa().scrollTop()},!0),$(document).on("keydown",function(a){var b=cc(a),c=dc(a),d=ec(a),e=b&&!c&&bc(a,78),f=b&&!c&&bc(a,79),g=b&&!c&&!d&&bc(a,83),h=b&&c&&!d&&bc(a,83),i=b&&bc(a,80),j=bc(a,122),k=b&&c&&bc(a,67),l=b&&c&&bc(a,78),m=b&&c&&bc(a,70),n=b&&d&&!c&&bc(a,83),q=b&&d&&bc(a,81),t=b&&bc(a,191),u=bc(a,27);if(e&&(a.preventDefault(),O.click()),f&&P.click(),g&&Q.click(),h&&R.click(),i&&S.click(),j&&(chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()),k&&o.click(),l&&(a.preventDefault(),p.click()),m&&s.click(),n&&r.click(),u&&(a.preventDefault(),nc()),t&&(F.is(":visible")?(_b(),Za(F)):(Zb(),Wa(F))),q){Ma(Na(ja(!0)))}}),X.on("keydown keyup change",function(){$(this).css("height","auto"),$(this).css("height",this.scrollHeight+"px")}),chrome.runtime.onMessage.addListener(function(a,b,c){(a.max||a.min||a.restored)&&Db(),a.full&&Cb(),a.open&&mc()}),$(".sign-out").css({height:"0",display:"none"}),$(".arrow-down").click(function(){$(".sign-out").is(":visible")?gc():fc()}),$(".sign-out").click(function(){Vb(),gc(),hc(),ic({signIn:!1})}),$(".tutorial-container .tutorial-close").click(function(){kc()}),$(".tutorial-container-two .tutorial-close").click(function(){$(".tutorial-container-two").fadeOut("fast"),Oa().focus()}),e.click(function(){$(".tutorial-container").is(":visible")?kc():$(".tutorial-container-two").is(":visible")&&$(".tutorial-container-two").fadeOut("fast")}),Yb(lc),$(".close-window").click(function(){nc()}),$(".maximize-window").click(function(){chrome.app.window.current().isMaximized()||chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}),$(".minimize-window").click(function(){chrome.app.window.current().minimize()})});
