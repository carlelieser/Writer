$(document).ready(function(){function W(a,b){V[a]=b,Cb()}function X(a){return a.charAt(0).toUpperCase()+a.slice(1)}function Y(a){V=a;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=["font","size","theme","margin"];if(d.indexOf(b)>-1){var e;e="size"==b?".font-"+b+"-options":"."+b+"-options",$(e).children().removeClass("active"),$(e).children().filter(function(){return $(this).text()==X(c)}).each(function(){$(this).click(),setTimeout(function(){r.css("height","0"),r.hide()},400)})}else c=!1===c?"toggle-inactive":"toggle-active","toggle-active"==c&&$("."+b).click(),"focus"==b&&"toggle-inactive"==c&&(ob=!1,$(".ql-editor *").css("opacity","1"))}$(".doc-active").click()}function ba(a,b){a.find(".document-title").val(b)}function ca(a,b){a.find(".document-size").text(b)}function da(){return $(".document-active")}function ea(a,b,c){a.removeClass(b),a.addClass(c)}function ga(){this.name,this.size,this.contents,this.fileEntry,this.savedFileEntry,this.isActive,this.editor,this.editorDOM,this.docListItem,fa=this}function ha(){s.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){r.css("height","0"),r.hide()},200)}),t.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){r.css("height","0"),r.hide()},200)}),v.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){r.css("height","0"),r.hide()},200)}),w.filter(function(){return $(this).hasClass("active")}).each(function(){$(this).click(),setTimeout(function(){r.css("height","0"),r.hide()},200)})}function ja(a){return/<[\s\S]*>/i.test(a)}function ka(a){return!$.trim(a.html())}function la(a){return a.replaceAll(' 0.6;"=""',"").replaceAll(' 1;"=""',"").replaceAll("=3D","=").replaceAll('="3D','="').replaceAll('class="3D&quot;','class="').replaceAll("&quot;","")}function ma(a){var b=$(document.createElement("div"));return b.addClass("htmlParent"),b.html(a),b.find("*").each(function(){ka($(this))&&$(this).html("<br/>")}),b.find("ol, ul").each(function(){var a=$(this).parentsUntil(b).length-1;if(-1!=a&&$(this).children().not("ol").not("ul").attr("class","ql-indent-"+a),!$(this).parent().is(b)){var c=$(this).contents();$(this).replaceWith(c)}}),b.find("li").each(function(){$(this).find("li").length&&$(this).find("li").insertAfter($(this))}),b.find("p").each(function(){if($(this).parent().is("li")||$(this).parent().is("blockquote")){var a=$(this).contents();$(this).replaceWith(a)}}),b.find("table").remove(),la(b.html())}function na(a){return-1==a.indexOf(".")?a:a.substr(0,a.lastIndexOf("."))}function oa(a){var b=$(document.createElement("div"));return b.html(a),b.find("*").removeAttr("style"),b.html()}function pa(a,b,c,d){a.write(c),b.loadFile(d.name,c.size,d,!1),cb(!1,!1,d.name),Cb()}function qa(a){a?chrome.fileSystem.getWritableEntry(a,function(a){a.createWriter(function(b){var e,f,c=Ba(a.name),d=za(da().index());switch(c){case"html":case"htm":case"wtr":e=oa(Aa().html()),f=new Blob([e]),pa(b,d,f,a);break;case"md":require(["upndown"],function(c){(new c).convert(oa(Aa().html()),function(c,g){c?console.log(c):(e=g,f=new Blob([e]),pa(b,d,f,a))})});break;case"docx":e="<!DOCTYPE HTML><html><head></head><body>"+oa(Aa().html())+"</body></html>",f=htmlDocx.asBlob(e),pa(b,d,f,a);break;case"pdf":f=pdfBlob,pa(b,d,f,a);break;case"txt":default:e=d.editor.getText(),f=new Blob([e]),pa(b,d,f,a)}var g=!1;b.onwriteend=function(a){if(!g)return g=!0,void this.truncate(f.size)}})}):console.log("User cancelled saving.")}function ra(a){a=na(a),window.navigator.userAgent.indexOf("CrOS")>-1&&(a+=".wtr"),chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:a,accepts:T},qa)}function sa(){aa.forEach(function(a,b,c){za(b).setActive(!1)})}function ta(a){za(a).editor.focus()}function ua(a){aa.push(a)}function va(a,b,c,d){a.create(b,c,d)}function wa(a,b,c,d,e){a.load(b,c,d,e)}function xa(a,b,c,d,e,f){var g=new ga;va(g,a,c,e),wa(g,a,b,c,d,f),ua(g),Va()}function ya(a){a.delete()}function za(a){return aa[a]}function Aa(){return $(".document-active .ql-editor")}function Ba(a){return a.substring(a.lastIndexOf(".")+1,a.length)}function Ca(a){"li"==a.get(0).nodeName.toLowerCase()?(Aa().find("*").css("opacity","0.6"),a.parent().css("opacity","1"),a.parent().children().css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1")):(Aa().find("*").css("opacity","0.6"),a.css("opacity","1"),a.find("*").css("opacity","1"))}function Da(a){a=a||window;var d,e,f,b=a.document,c=b.selection,g=0;return c?"Control"!=c.type&&(d=c.createRange(),d.collapse(!0),x=d.boundingLeft,g=d.boundingTop):a.getSelection&&(c=a.getSelection(),c.rangeCount&&(d=c.getRangeAt(0).cloneRange(),d.getClientRects&&(d.collapse(!0),e=d.getClientRects(),e.length>1&&(f=e[1]),void 0===f&&void 0===(f=e[0])&&(f=Fa(),$(f).hasClass("ql-editor")||(f=f.getClientRects()[0])),g=f.top))),{y:g}}function Ea(a){setTimeout(function(){var b=Aa(),c=b.scrollTop(),d=Da(),e=c+d.y-b.height()+50;a?b.stop().animate({scrollTop:e},300,S,function(){za(da().index()).scrollTop=e}):b.filter(":not(:animated)").animate({scrollTop:e},300,S,function(){za(da().index()).scrollTop=e})},1)}function Fa(){var a,b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount>0&&(a=b.getRangeAt(0))),a)return c=a.commonAncestorContainer,3===c.nodeType?c.parentNode:c}function Ga(){if(!1===ob);else{var a=Fa(),b=a.nodeName.toLowerCase(),c=["h1","h2","h3","h4","h5","h6","p","blockquote","pre","li"];if($(a).hasClass("ql-editor"));else if(-1==c.indexOf(b)){for(;-1==c.indexOf(b);)a=$(a).parent(),b=a.prop("tagName").toLowerCase();Ca($(a))}else Ca($(a))}}function Ha(a,b){a==y&&Na(),Aa().blur(),window.getSelection().removeAllRanges(),h.is(":visible")?a.show().filter(":not(:animated)").animate({left:"0"},200,S,function(){b&&b()}):h.show().filter(":not(:animated)").animate({opacity:"0.5"},200,S,function(){a.show().filter(":not(:animated)").animate({left:"0"},200,S)})}function Ia(){h.filter(":not(:animated)").animate({opacity:"0"},200,S,function(){$(this).hide(),ta(da().index()),Ga();var a=za(da().index()).scrollTop;da().children().first().scrollTop(a)})}function Ja(a){a.filter(":not(:animated)").animate({left:"-"+a.width()},200,S,function(){$(this).hide()}),1==g.filter(function(){return $(this).is(":visible")}).length&&Ia()}function Ka(){Ja(g),Ia()}function Ma(a){var c,d,b=Ba(a.name),e=aa.indexOf(a),f=$(".document-"+e).find(".ql-editor").html();switch(b){case"html":case"htm":case"wtr":c=f,d=new Blob([c]);break;case"md":c=toMarkdown(f),d=new Blob([c]);break;case"docx":c="<!DOCTYPE HTML><html><head></head><body>"+f+"</body></html>",d=htmlDocx.asBlob(c);break;case"txt":default:c=a.editor.getText(),d=new Blob([c])}return Math.floor(d.size/1e3)}function Na(){a.children().each(function(){var a=za($(this).index()),b=Ma(a);a.setSize(b+" KB"),ca($(this),b+" KB")})}function Oa(a,b){var c=new FileReader;c.onload=function(){var d=this.result;if(d.indexOf('<w:altChunk r:id="htmlChunk" />')>-1)d=d.substring(d.lastIndexOf("<!DOCTYPE HTML><html><head></head><body>")+15,d.lastIndexOf("</body></html>")),xa(a.name,d,a.size,b,!0,!1),Ka();else{new FileReader;c.onload=function(){var c=this.result;mammoth.convertToHtml({arrayBuffer:c}).then(function(d){c=d.value,xa(a.name,c,a.size,b,!0,!1),Ka()}).done()},c.readAsArrayBuffer(a)}},c.readAsText(a)}function Pa(a){return a.replace(/\n\n  \n\n\n/g,"<p><p>")}function Qa(a,b,c){var d=new FileReader;d.onload=function(){var d=this.result;c?(d=Pa(d),d=marked(d),d=ma(d),xa(a.name,d,a.size,b,!0,!1),Ka()):(xa(a.name,d,a.size,b,!0,!1),Ka())},d.readAsText(a)}function Ra(a){for(var b=0;b<aa.length;b++)if(aa[b].path==a)return!0;return!1}function Sa(a){a.forEach(function(a,b,c){var d=a;1==Ra(d.fullPath)?(Ka(),cb(!0,"is already open.",d.name)):d.file(function(a){switch(Ba(a.name)){case"md":Qa(a,d,!0);break;case"docx":Oa(a,d);break;case"html":case"htm":case"txt":case"wtr":default:Qa(a,d,!1)}})})}function Ta(a,b){var c=new FileReader;c.onload=function(){var a=this.result;void 0!=b&&b.attr("src",a)},c.readAsDataURL(a)}function Ua(a,b){if(-1==a.indexOf("data:")){var c=new XMLHttpRequest;c.open("GET",a),c.responseType="blob",c.onload=function(){Ta(c.response,b)}.bind(this),c.send()}b.show()}function Va(){Aa().find("img").each(function(){if(void 0===$(this).attr("src"));else{Ua($(this).attr("src"),$(this))}})}function Wa(a){var b=Ya(a);return Math.round(b/200)+" Min"}function Xa(a){return a.replace(/\n$/gm,"").split(/\n/).length}function Ya(a){var b=a.trim().replace(/\s+/gi," ").split(" ");return b=""===b[0]&&1==b.length?0:b.length}function Za(a){return a.length-1}function $a(a){return null===a.match(/[\S]/g)?0:a.match(/[\S]/g).length}function _a(a,b){var c=a.editor.getText();ab({name:a.name,time:Wa(c),paragraphs:Xa(c),words:Ya(c),chars:Za(c),charsExSpaces:$a(c)},b)}function ab(a,b){var c=0;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];switch(d){case"name":$(".file-name-details").text(e);break;case"time":$(".est-time-amount").text(e);break;case"paragraphs":$(".paragraph-amount").text(e);break;case"words":$(".word-amount").text(e);break;case"chars":$(".character-amount").text(e);break;case"charsExSpaces":$(".characters-without-spaces-amount").text(e)}c++,c===a.length&&b()}}function cb(a,b,c){a||b?(Q.children().first().text(c),Q.children("span").text(b),Q.show().stop().animate({bottom:"0"},500,S,function(){bb=setTimeout(db,5e3)})):(Q.children().first().text(c),Q.children("span").text("was saved."),Q.show().stop().animate({bottom:"0"},500,S,function(){bb=setTimeout(db,3e3)}))}function db(){Q.animate({bottom:"-"+(Q.height()+100)+"px"},500,S,function(){$(this).hide(),clearTimeout(bb)})}function eb(a){return a.hasClass("toggle-active")}function ib(){$(".ql-editor").css("transition","none"),$(".ql-editor *").css("transition","none"),clearTimeout(hb),hb=setTimeout(function(){jb()},200)}function jb(){$(".ql-editor").css("transition","all .2s ease"),$(".ql-editor *").css("transition","all .2s ease")}function kb(a){var b='<link type="text/css" rel="stylesheet" href="assets/settings/themes/'+a+'"/>';$('link[href="'+a+'"]').length<1&&$("head").append(b)}function lb(a){$('link[href="assets/settings/themes/'+a+'"]').remove()}function mb(){var a=n.attr("name");ea(n,"toggle-inactive","toggle-active"),W(a,!0)}function nb(){var a=n.attr("name");ea(n,"toggle-active","toggle-inactive"),W(a,!1)}function pb(a){var b=$(".words"),c=$(".chars"),d=/\s+/gi,e=a.trim().replace(d," ").split(" "),f=a.length-1;e=""===e[0]&&1==e.length?0:e.length,b.text(e),c.text(f)}function qb(){pb(za(da().index()).editor.getText()),R.show().stop().animate({bottom:"0"},300,S)}function rb(){R.stop().animate({bottom:"-"+(R.height()+50)+"px"},300,S,function(){$(this).hide()})}function sb(a){return Number(a.replace("px",""))/12+.25+"em"}function tb(a){$(".ql-editor").css("padding-left",a),$(".ql-editor").css("padding-right",a)}function ub(a){var b=40*a.children().length+"px";a.stop().show().animate({height:b},400,S)}function vb(a){a.stop().animate({height:"0"},400,S,function(){$(this).hide()})}function wb(a,b){a.attr("readonly",!0),a.blur(),b.find(".material-icons").length>1?b.find(".material-icons").eq(1).text("edit"):b.find(".material-icons").text("edit")}function xb(a,b){a.attr("readonly",!1),a.select(),b.find(".material-icons").length>1?b.find(".document-edit").find(".material-icons").text("check"):b.find(".material-icons").text("check")}function yb(a){"matrix(1, -2.44929e-16, 2.44929e-16, 1, 0, 0)"==a.css("transform")?a.css("transform","rotate(0deg)"):a.css("transform","rotate(360deg)")}function zb(a){a.css("transform","translateX(-220px)")}function Ab(a){a.css("transform","translateX(0)")}function Bb(){setTimeout(function(){if(1==V.statistics){pb(za(da().index()).editor.getText())}i.stop().animate({top:"-100%"},800,S,function(){$(this).remove()})},800)}function Cb(){chrome.storage.local.set({settings:V,data:aa})}function Db(a,b){var c=new XMLHttpRequest;c.onload=function(){var a=new FileReader;a.onloadend=function(){b(a.result)},a.readAsDataURL(c.response)},c.open("GET",a),c.responseType="blob",c.send()}function Eb(a){var c=a;return 255-(.299*c.r+.587*c.g+.114*c.b)<105?"#000000":"#ffffff"}function Fb(){chrome.identity.removeCachedAuthToken({token:Hb},function(){});var a=new XMLHttpRequest;a.open("GET","https://accounts.google.com/o/oauth2/revoke?token="+Hb),a.send()}function Gb(a,b){navigator.onLine?chrome.identity.getAuthToken({interactive:!0},function(c){Hb=c,chrome.runtime.lastError?!1===a?Fb():(Bb(),j.show(),chrome.storage.local.set({installed:!1})):$.get("https://www.googleapis.com/plus/v1/people/me?access_token="+c,function(a){var c=a.cover.coverPhoto.url,d=a.image.url,e=a.displayName;Db(d,function(a){$(".user-image").css("background-image","url("+a+")");var c=document.createElement("img");c.setAttribute("src",a),c.addEventListener("load",function(){var a=new Vibrant(c),d=a.DarkMutedSwatch.rgb,e=d.join(","),f=Eb(d);$(".user-info").css("color",f),$(".fallback-signin").hide(),$(".sign-out").css({backgroundColor:"rgb("+e+")",color:f}),$(".sign-out .material-icons").css("color",f),$(".user-profile-body").show(),chrome.storage.local.set({installed:!0,signIn:!0}),b&&(j.stop().animate({top:"-100%"},800,S,function(){$(this).remove()}),b())})}),Db(c,function(a){$(".user-profile").css("background-image","url("+a+")")}),$(".user-name").text(e),chrome.identity.getProfileUserInfo(function(a){$(".user-email").text(a.email)})}).fail(function(){Fb()})}):(j.hide(),Ub())}function Ib(a){chrome.storage.local.get({installed:"installed",signIn:"signIn"},function(a){var b=a.installed,c=a.signIn;"installed"==b||!1===b||"signIn"==c?(Bb(),j.show()):!1===c?Ub():Gb(!1,Ub)})}function Jb(){clearTimeout(Kb),c.stop().animate({top:"0"},400,S),b.css("margin-top","30px"),b.css("height","calc(100% - 30px)"),g.css("margin-top","30px"),g.css("height","calc(100% - 30px)")}function Lb(){clearTimeout(Kb),Kb=setTimeout(function(){c.stop().animate({top:"-30px"},400,S),b.css("margin-top","0px"),b.css("height","100%"),g.css("margin-top","0px"),g.css("height","100%")},1e3)}function Mb(){var a="Unknown OS",b=navigator.appVersion;return-1!=b.indexOf("Win")&&(a="Windows"),-1!=b.indexOf("Mac")&&(a="MacOS"),-1!=b.indexOf("X11")&&(a="UNIX"),-1!=b.indexOf("Linux")&&(a="Linux"),a}function Nb(a,b){return a.keyCode==b}function Ob(a){return"MacOS"==Mb()?a.metaKey:a.ctrlKey}function Pb(a){return a.shiftKey}function Qb(a){return a.altKey}function Rb(){$(".arrow-down .material-icons").css("transform","rotate(180deg)"),$(".sign-out").show().stop().animate({height:"60px"},200,S)}function Sb(){$(".arrow-down .material-icons").css("transform","rotate(0deg)"),$(".sign-out").stop().animate({height:"0px"},200,S,function(){$(this).hide()})}function Tb(){$(".user-profile").css("background-image","url(../assets/sidebar/fallback.png)"),$(".user-profile-body").hide(),$(".fallback-signin").show()}function Ub(){chrome.storage.local.get({settings:"settings",data:"documents"},function(a){var b=a.settings,c=a.data;if("settings"==b||"documents"==c)xa("untitled","","0 KB",!1,!0,!1),Y(U),Bb();else{var d=0;0===c.length?(xa("untitled","","0 KB",!1,!0,!1),Y(b),Bb()):c.forEach(function(a,e,f){var g=c[e];xa(g.name,g.contents,g.size,g.savedFileEntry,g.isActive,g.changed),da().children().first().children().css("opacity","0.6"),da().children().first().children().first().css("opacity","1"),++d===f.length&&(Vb(),Y(b),Bb())})}})}function Vb(){if(launchData&&launchData.items)for(var a=0;a<launchData.items.length;a++){var b=[];b.push(launchData.items[a].entry),Sa(b)}}require.config({paths:{upndown:"/assets/libs/upndown/lib/upndown.bundle.min"}});var a=$(".document-list"),b=$(".main-container"),c=$(".navigation-container"),d=$(".sidebar"),e=$(".sidebar-toggle"),g=($(".settings-container"),$(".modal")),h=$(".bg"),i=$(".loading-screen"),j=$(".install-screen"),k=$(".toggle"),l=$(".coffee"),m=$(".night"),n=$(".full"),o=$(".statistics"),p=$(".focus"),q=$(".settings-option"),r=$(".option"),s=$(".font-options").children(),t=$(".font-size-options").children(),u=$(".theme-options").children(),v=$(".line-options").children(),w=$(".margin-options").children(),y=$(".document-container"),z=$(".settings-container"),A=$(".feedback-container"),B=$(".details-container"),C=$(".help-container"),D=$(".file-container"),E=$(".open-documents"),F=$(".open-settings"),G=$(".open-feedback"),H=$(".open-details"),I=$(".open-help"),J=$(".open-file"),K=$(".modal-close"),L=$(".new"),M=$(".open"),N=$(".save"),O=$(".save-as"),P=$(".print"),Q=$(".snackbar"),R=$(".statistics-bar"),S=$.bez([.17,.67,.29,1.01]),T=[{description:"Writer Document (*.wtr)",extensions:["wtr"]},{description:"Word Document (*.docx)",extensions:["docx"]},{description:"Markdown File (*.md)",extensions:["md"]},{description:"HTML File (*.html)",extensions:["html"]},{description:"HTM File (*.htm)",extensions:["htm"]},{description:"Text File (*.txt)",extensions:["txt"]}],U={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},V={coffee:!1,night:!1,full:!1,statistics:!1,focus:!0,font:"Charter",size:"16px",theme:"default",line:"single",margin:"medium"},Z='<div class="document-item"><div class="material-icons">insert_drive_file</div><input readonly=true class="document-title" type="text"/><div class="document-size"></div><div class="document-edit"><div class="material-icons">edit</div></div><div class="document-delete"><div class="material-icons">delete</div></div><div class="delete-dialogue"><div class="delete-confirm">Delete</div><div class="delete-cancel">Cancel</div></div></div>',_='<div class="document document-active"></div>';$(".sidebar, .settings-container, .document-container, .bg, .option, .snackbar").hide();var fa,aa=[];ga.prototype.setName=function(a){this.name=a},ga.prototype.getName=function(){return this.name},ga.prototype.setContents=function(a){this.contents=a},ga.prototype.getContent=function(){return this.contents},ga.prototype.setSize=function(a){this.size=a},ga.prototype.getSize=function(){return this.size},ga.prototype.setFileEntry=function(a){"string"==typeof a?this.loadFileEntry(a):(this.fileEntry=a,null===a||void 0===a||!1===a||(this.path=this.fileEntry.fullPath,this.setName(a.name),this.setSavedFileEntry(a)))},ga.prototype.getFileEntry=function(){return this.fileEntry},ga.prototype.setSavedFileEntry=function(a){this.savedFileEntry=chrome.fileSystem.retainEntry(a)},ga.prototype.getSavedFileEntry=function(){return this.savedFileEntry},ga.prototype.loadFileEntry=function(a){var b=this;chrome.fileSystem.restoreEntry(a,function(a){b.setFileEntry(a),b.path=b.fileEntry.fullPath})},ga.prototype.createEditor=function(a){var b={alignLeft:{key:"W",shortKey:!0,handler:function(a,b){"left"!=b.format.align&&this.quill.formatLine(a,"align",!1)}},alignCenter:{key:"E",shortKey:!0,handler:function(a,b){"center"!=b.format.align?this.quill.formatLine(a,"align","center",!0):this.quill.formatLine(a,"align",!1)}},alignRight:{key:"R",shortKey:!0,handler:function(a,b){"right"!=b.format.align?this.quill.formatLine(a,"align","right",!0):this.quill.formatLine(a,"align",!1)}},makeHeadingOne:{key:"1",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",1,!0)}},makeHeadingTwo:{key:"2",shortKey:!0,altKey:!0,handler:function(a,b){2==b.format.header?this.quill.formatLine(a,"header",!1):this.quill.formatLine(a,"header",2,!0)}},makeQuote:{key:"5",shortKey:!0,altKey:!0,handler:function(a,b){b.format.blockquote?this.quill.formatLine(a,"blockquote",!1):this.quill.formatLine(a,"blockquote",!0)}},makeCode:{key:"6",shortKey:!0,altKey:!0,handler:function(a,b){1==b.format["code-block"]?this.quill.formatLine(a,"code-block",!1):this.quill.formatLine(a,"code-block",!0)}}};this.editor=new Quill(a,{modules:{keyboard:{bindings:b},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{align:[]}],["blockquote","code-block","link"],[{header:1},{header:2}]]},scrollingContainer:".main-container",bounds:".main-container",theme:"bubble"});var c=this,d=this.editor;this.editorDOM=$(a).children().first();var e=this.editorDOM;ha(),1==V.statistics&&pb(d.getText());var f;this.editor.on("text-change",function(){clearTimeout(f),f=setTimeout(function(){var f,b=za($(a).index()),c=b.getContent();f=ja(c)?e.html():d.getContents(),b.setContents(f),Cb()},2e3),c.changed=!0,1==V.statistics&&pb(c.editor.getText())}),$(a).hasClass("document-active")&&(ib(),e.children().first().focus())},ga.prototype.getEditor=function(){return this.editorDOM},ga.prototype.getDocItem=function(){return this.docListItem},ga.prototype.setActive=function(a){this.isActive=a},ga.prototype.showCreate=function(c,d,e){a.append(Z),b.append(_);var f=a.children().last();this.docListItem=f,!1===e?(b.children().last().attr("class","document-"+f.index()+" ql-container ql-bubble"),this.setActive(!1)):(a.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),b.children().removeClass("document-active"),b.children().last().attr("class","document-"+f.index()+" document-active ql-container ql-bubble"),this.setActive(!0)),this.createEditor(".document-"+f.index()),ba(f,c),ca(f,d)},ga.prototype.show=function(c){a.children().removeClass("doc-active"),this.docListItem.addClass("doc-active"),b.children().removeClass("document-active"),b.children().eq(c).attr("class","document-"+c+" document-active ql-container ql-bubble"),this.editorDOM.scrollTop(this.scrollTop),this.setActive(!0),1==V.statistics&&pb(this.editor.getText()),Cb()},ga.prototype.create=function(a,b,c){this.setName(a),this.setContents(""),this.setSize(b),this.setFileEntry(!1),this.showCreate(a,b,c)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},ga.prototype.setEditorContents=function(a){if("object"==typeof a)this.editor.setContents(a);else if(ja(a)){var b=ma(a);this.editorDOM.html(b)}else this.editor.setText(a);this.editor.history.clear()},ga.prototype.load=function(a,b,c,d,e){this.setName(a),this.setContents(b),this.setEditorContents(b),this.setSize(c),this.setFileEntry(d),this.changed=e},ga.prototype.loadFile=function(a,b,c,d){this.setName(a),this.setSize(b),this.setFileEntry(c),this.changed=d,ba($(".doc-active"),a),ca($(".doc-active"),b)},ga.prototype.save=function(){var a=this.fileEntry,b=na(this.name);a?qa(a):ra(b)},ga.prototype.delete=function(){var b=aa.indexOf(this);this.editorDOM.parent().remove(),this.docListItem.remove(),aa.splice(b,1),0===aa.length?(xa("untitled","","0 KB",!1,!0,!1),Ka()):b-1==aa.length-1?a.children().last().click():a.children().eq(b).click()},$(document).on("keyup",".ql-editor",function(a){Ea([37,38,39,40,13].indexOf(a.keyCode)>-1),Lb(),Ga()}),$(document).on("click select",".ql-editor",function(){Ea(),Ga()}),$(".top-bar").mouseenter(function(){Jb()}),$(document).on("mouseenter",".ql-editor",function(){Lb()});var La;e.click(function(){La=$(Fa()),Jb(),Ha(d)}),E.click(function(){Ha(y)}),F.click(function(){Ha(z)}),h.click(function(){var a=0;g.each(function(b){var c=parseInt($(this).css("zIndex"),10);c>a&&$(this).is(":visible")&&(a=c)}),g.filter(function(){return $(this).css("z-index")==a}).each(function(){Ja($(this))})}),K.click(function(){Ja($(this).parent().parent())}),L.click(function(){xa("untitled","","0 KB",!1,!0,!1),Ka()}),M.click(function(){chrome.fileSystem.chooseEntry({type:"openFile",acceptsMultiple:!0,accepts:T},function(a){Sa(a)})}),N.click(function(){za(da().index()).save(),Ka()}),O.click(function(){ra(za(da().index()).name),Ka()}),P.click(function(){var a=Aa().html();$("html").append('<div class="ql-editor" id="print"></div>');var c=$("#print");c.html(a),window.print(),c.remove()}),J.click(function(){Ha(D)}),G.click(function(){Ha(A,function(){A.find(".feedback-email").val($(".user-email").text()),A.find(".feedback-email").focus()})}),$(document).on("paste drop",function(){setTimeout(Va,0)}),$(document).on("error","img",function(){$(this).hide()}),$(".submit-button").click(function(){var b=($(".feedback-email").val(),$(".feedback-subject").val()),c=$(".feedback-message").val(),d="mailto:writerchromeapp@gmail.com?subject="+b+"&body="+c,e=document.createElement("a");e.href=d,e.target="_blank",e.click()}),H.click(function(){_a(za(da().index()),Ha(B))}),I.click(function(){Ha(C)}),Q.css("bottom","-"+(Q.height()+100)+"px");var bb;$(document).on("click",".document-item",function(){var a=$(this).index(),b=za(a);sa(),b.show(a),Ka()}),k.click(function(){var a=$(this).attr("name");eb($(this))?(ea($(this),"toggle-active","toggle-inactive"),W(a,!1)):(ea($(this),"toggle-inactive","toggle-active"),W(a,!0))}),k.mousedown(function(){$(this).children().css("transform","scale(1.15, .85)"),$(this).children().css("box-shadow","rgba(0, 0, 0, 0.1) 0px 0px 0px 8px")}),$(document).mouseup(function(){k.children().css("transform","none"),k.children().css("box-shadow","none")});var fb="/assets/settings/coffee.mp3",gb=new Audio(fb);l.click(function(){eb($(this))?gb.play():gb.pause()});var hb;m.click(function(){ib(),!1===eb($(this))?lb("night.css"):kb("night.css")}),n.click(function(){chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()});var ob;p.click(function(){!1===eb($(this))?(ob=!1,$(".ql-editor *").css("opacity","1")):(ob=!0,void 0===La&&(La=Aa().children().first()),Ca(La))}),R.css("bottom","-"+(R.height()+100)+"px"),o.click(function(){!1===eb($(this))?rb():qb()}),s.click(function(){var a=$(this).text();$(".ql-editor").css("font-family",a),W("font",a)}),t.click(function(){var a=$(this).text();$(".ql-editor").css("font-size",sb(a)),W("size",a)}),u.click(function(){var a=$(this).text();switch(a){case"Default":lb("dark.css"),lb("turquoise.css");break;case"Dark":kb("dark.css"),lb("turquoise.css");break;case"Turquoise":kb("turquoise.css"),lb("dark.css")}W("theme",a)}),v.click(function(){var a=$(this).text(),b=a;"Single"==a&&(b=1),"Double"==a&&(b=2),$(".ql-editor").css("line-height",b),W("line",a)}),w.click(function(){var a=$(this).text(),b=a;switch(a){case"Small":b="8%";break;case"Medium":b="18%";break;case"Large":b="26%"}tb(b),W("margin",a)}),q.click(function(){if($(this).hasClass("noToggle")){var a=$(this).children().last();a.is(":visible")?vb(a):ub(a)}}),r.children().click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}),$(document).on("click",".document-edit",function(a){a.stopImmediatePropagation(),a.stopPropagation();var b=$(this).parent().find("input"),c=b.parent().index(),d=b.val(),e=za(c);"check"==$(this).text()?(wb(b,$(this)),d==e.name||(e.setFileEntry(null),e.setName(d))):xb(b,$(this)),yb($(this).find(".material-icons"))}),$(document).on("keyup",".document-title",function(a){var b=$(this).parent().index(),c=za(b),d=$(this).val();13==a.keyCode&&(wb($(this),$(this).parent()),yb($(this).parent().find(".document-edit").find(".material-icons")),d==c.name||(c.setFileEntry(null),c.setName(d)))}),$(document).on("click",".document-title",function(a){void 0===$(this).attr("readonly")&&(a.stopImmediatePropagation(),a.stopPropagation())}),$(document).on("click",".document-delete",function(a){a.stopPropagation();var b=$(this).parent().index(),c=za(b);c.changed?zb($(this).parent()):ya(c)}),$(document).on("click",".delete-confirm",function(a){a.stopPropagation(),ya(za($(this).parent().parent().index()))}),$(document).on("click",".delete-cancel",function(a){a.stopPropagation(),Ab($(this).parent().parent())}),$(document).on("click",".ql-editor img",function(a){a.stopPropagation(),a.stopImmediatePropagation()});var Hb;$(".signin-button").click(function(){Gb(!0,Ub)}),$(".fallback-signin").click(function(){Gb(!1)}),$(".continue-button").click(function(){j.stop().animate({top:"-100%"},400,S,function(){$(this).remove(),Ub()}),chrome.storage.local.set({installed:!0,signIn:!1})});var Kb;Jb(),document.addEventListener("scroll",function(a){za(da().index()).scrollTop=Aa().scrollTop()},!0),$(document).on("keydown",function(a){var b=Ob(a),c=Pb(a),d=Qb(a),e=b&&!c&&Nb(a,78),f=b&&!c&&Nb(a,79),g=b&&!c&&!d&&Nb(a,83),h=b&&c&&!d&&Nb(a,83),i=b&&Nb(a,80),j=Nb(a,122),k=b&&c&&Nb(a,78),l=b&&c&&Nb(a,70),n=b&&d&&!c&&Nb(a,83),q=b&&d&&Nb(a,81),r=b&&Nb(a,191),s=Nb(a,27);if(e&&(a.preventDefault(),L.click()),f&&M.click(),g&&N.click(),h&&O.click(),i&&P.click(),j&&(chrome.app.window.current().isFullscreen()?chrome.app.window.current().restore():chrome.app.window.current().fullscreen()),k&&(a.preventDefault(),m.click()),l&&p.click(),n&&o.click(),s&&(a.preventDefault(),window.close()),r&&(C.is(":visible")?(Lb(),Ja(C)):(Jb(),Ha(C))),q)if(y.is(":visible"))$(".doc-active").find(".delete-confirm").click();else{var t=za(da().index());t.changed?Ha(y,$(".doc-active").find(".document-delete").click()):$(".doc-active").find(".document-delete").click()}}),$(".feedback-message").on("keydown keyup change",function(){$(this).css("height","auto"),$(this).css("height",this.scrollHeight+"px")}),chrome.runtime.onMessage.addListener(function(a,b,c){(a.max||a.min||a.restored)&&nb(),a.full&&mb(),a.open&&Vb()}),$(".sign-out").css({height:"0",display:"none"}),$(".arrow-down").click(function(){$(".sign-out").is(":visible")?Sb():Rb()}),$(".sign-out").click(function(){Fb(),Sb(),Tb(),chrome.storage.local.set({signIn:!1})}),Ib(Ub),$(".close-window").click(function(){chrome.app.window.current().close()}),$(".maximize-window").click(function(){chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}),$(".minimize-window").click(function(){chrome.app.window.current().minimize()})});
